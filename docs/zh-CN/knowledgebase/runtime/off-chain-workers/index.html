<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>链外计算 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="本文介绍在 Substrate runtime 中使用链下工作机的技术开发方面。 For a conceptual overview of off-chain workers see the [Conceptual Guide](../learn-substrate/off-chain-workers)."/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="链外计算 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="本文介绍在 Substrate runtime 中使用链下工作机的技术开发方面。 For a conceptual overview of off-chain workers see the [Conceptual Guide](../learn-substrate/off-chain-workers)."/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/ui.js" defer=""></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-CN/" target="_self">文档</a></li><li class=""><a href="/recipes" target="_self">Recipes</a></li><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/zh-CN/community" target="_self">社区</a></li><li class=""><a href="https://github.com/paritytech/substrate" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/knowledgebase/runtime/off-chain-workers">English</a></li><li><a href="/docs/ru/knowledgebase/runtime/off-chain-workers">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Runtime</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">开始<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/windows-users">Getting Started on Windows</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/glossary">词汇表</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Learn Substrate<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/tx-pool">Transaction Pool</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/account-abstractions">Account Abstractions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/session-keys">会话密钥</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/weight">交易权重</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/off-chain-workers">链外计算</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Runtime<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/primitives">运行时原语</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/frame">FRAME</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/pallets">Pallets</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/macros">运行时宏</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/metadata">Runtime Metadata</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/storage">Runtime Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/origin">Runtime Origin</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/execution">运行时执行</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/events">运行时事件</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/fees">交易费用</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/off-chain-workers">链外计算</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/tests">运行时测试</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">智能合约<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/">ink! Smart Contracts</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/overview">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/ink-fundamentals">ink! Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/env-types">智能合约运行时环境类型</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/ink-development">ink! Development</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/evm-pallet">EVM Pallet</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/faq">ink! F.A.Q.</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Integrate<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/polkadot-js">Polkadot-JS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/libraries">Client Libraries</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/chain-spec">链描述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/subkey">The subkey Tool</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Advanced<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/codec">SCALE 编解码器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/consensus">Consensus</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/block-import">The Block Import Pipeline</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/executor">Executor</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/cryptography">密码学</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/storage">Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/ss58-address-format">SS58 地址格式</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">贡献<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/contribute/help-translate">参与翻译</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">链外计算</h1></header><article><div><span><p>本文介绍在 Substrate runtime 中使用链下工作机的技术开发方面。 For a conceptual overview of off-chain workers see the <a href="../learn-substrate/off-chain-workers">Conceptual Guide</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="在-runtime-中使用链下工作机"></a><a href="#在-runtime-中使用链下工作机" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 Runtime 中使用链下工作机</h2>
<p>创建一个链下工作机的逻辑，可以将其放在它自己的 pallet 中。 在本示例中，我们将此 pallet 称为：<code>my_offchain_worker</code>。 它属于 runtime ，所以源文件目录为：<code>runtime/src/my_offchain_worker.rs</code>。</p>
<p>首先，包括以下模块：</p>
<pre><code class="hljs css language-rust"><span class="token comment">// 为了更好地调试（打印）支持</span>
<span class="token keyword">use</span> support<span class="token punctuation">::</span><span class="token punctuation">{</span> debug<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> system<span class="token punctuation">::</span>offchain<span class="token punctuation">;</span>
<span class="token keyword">use</span> sp_runtime<span class="token punctuation">::</span>transaction_validity<span class="token punctuation">::</span><span class="token punctuation">{</span>
  TransactionValidity<span class="token punctuation">,</span> TransactionLongevity<span class="token punctuation">,</span> ValidTransaction<span class="token punctuation">,</span> InvalidTransaction
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>在 pallet 的配置 trait 中包括以下关联类型，用于从链下工作机发送已签名和未签名的交易。</p>
<pre><code class="hljs css language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> Trait<span class="token punctuation">:</span> timestamp<span class="token punctuation">::</span>Trait <span class="token operator">+</span> system<span class="token punctuation">::</span>Trait <span class="token punctuation">{</span>
  <span class="token comment">/// 总的事件类型</span>
  <span class="token keyword">type</span> Event<span class="token punctuation">:</span> From<span class="token operator">&lt;</span>Event<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">>></span> <span class="token operator">+</span> Into<span class="token operator">&lt;&lt;</span><span class="token keyword">Self</span> <span class="token keyword">as</span> system<span class="token punctuation">::</span>Trait<span class="token operator">></span><span class="token punctuation">::</span>Event<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">type</span> Call<span class="token punctuation">:</span> From<span class="token operator">&lt;</span>Call<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">>></span><span class="token punctuation">;</span>

  <span class="token keyword">type</span> SubmitSignedTransaction<span class="token punctuation">:</span> offchain<span class="token punctuation">::</span>SubmitSignedTransaction<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">Self</span> <span class="token keyword">as</span> Trait<span class="token operator">></span><span class="token punctuation">::</span>Call<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">type</span> SubmitUnsignedTransaction<span class="token punctuation">:</span> offchain<span class="token punctuation">::</span>SubmitUnsignedTransaction<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">Self</span> <span class="token keyword">as</span> Trait<span class="token operator">></span><span class="token punctuation">::</span>Call<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在宏 <code>decl_module！</code> 模块中，定义 <code>offchain_worker</code> 函数。 This function serves as the entry point of the off-chain worker and runs after every block import.</p>
<pre><code class="hljs css language-rust"><span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">enum</span> Call <span class="token keyword">where</span> origin<span class="token punctuation">:</span> T<span class="token punctuation">::</span>Origin <span class="token punctuation">{</span>

    <span class="token comment">// --snip--</span>

    <span class="token keyword">fn</span> <span class="token function">offchain_worker</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      debug<span class="token punctuation">::</span><span class="token function">info!</span><span class="token punctuation">(</span><span class="token string">"Hello World."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>默认情况下，链下工作机无法直接访问用户密钥（即使在开发环境中），由于安全原因，只能访问应用指定的子密钥（subkeys）。 需要在 runtime 顶部定义 <code>KeyTypeId</code> 用于将应用指定的子密钥分组，如下所示：</p>
<pre><code class="hljs css language-rust"><span class="token comment">// 密钥类型ID可以是任何4个字符的字符串</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> KEY_TYPE<span class="token punctuation">:</span> KeyTypeId <span class="token operator">=</span> <span class="token function">KeyTypeId</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">b"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// --snip--</span>

<span class="token keyword">pub</span> <span class="token keyword">mod</span> crypto <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span>KEY_TYPE<span class="token punctuation">;</span>
  <span class="token keyword">use</span> sp_runtime<span class="token punctuation">::</span>app_crypto<span class="token punctuation">::</span><span class="token punctuation">{</span>app_crypto<span class="token punctuation">,</span> sr25519<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">app_crypto!</span><span class="token punctuation">(</span>sr25519<span class="token punctuation">,</span> KEY_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>和任何其他 pallet 一样，runtime 必须实现 pallet 的配置 trait。 进入位于 <code>runtime/src/lib.rs</code> 的 runtime <code>lib.rs</code>。</p>
<pre><code class="hljs css language-rust"><span class="token comment">// Define the transaction signer using the key definition</span>
<span class="token keyword">type</span> SubmitTransaction <span class="token operator">=</span> system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span>TransactionSubmitter<span class="token operator">&lt;</span>
  offchain_pallet<span class="token punctuation">::</span>crypto<span class="token punctuation">::</span>Public<span class="token punctuation">,</span> Runtime<span class="token punctuation">,</span> UncheckedExtrinsic<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">impl</span> offchain_pallet<span class="token punctuation">::</span>Trait <span class="token keyword">for</span> Runtime <span class="token punctuation">{</span>
  <span class="token keyword">type</span> Event <span class="token operator">=</span> Event<span class="token punctuation">;</span>
  <span class="token keyword">type</span> Call <span class="token operator">=</span> Call<span class="token punctuation">;</span>

  <span class="token comment">// To use signed transactions in your runtime</span>
  <span class="token keyword">type</span> SubmitSignedTransaction <span class="token operator">=</span> SubmitTransaction<span class="token punctuation">;</span>

  <span class="token comment">// To use unsigned transactions in your runtime</span>
  <span class="token keyword">type</span> SubmitUnsignedTransaction <span class="token operator">=</span> SubmitTransaction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>然后为 runtime 实现 <code>system::offchain::CreateTransaction</code> trait。 仍然在 <code>lib.rs</code> 中：</p>
<pre><code class="hljs css language-rust"><span class="token keyword">use</span> sp_runtime<span class="token punctuation">::</span>transaction_validity<span class="token punctuation">;</span>

<span class="token comment">// --snip--</span>

<span class="token keyword">impl</span> system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span>CreateTransaction<span class="token operator">&lt;</span>Runtime<span class="token punctuation">,</span> UncheckedExtrinsic<span class="token operator">></span> <span class="token keyword">for</span> Runtime <span class="token punctuation">{</span>
  <span class="token keyword">type</span> Public <span class="token operator">=</span> <span class="token operator">&lt;</span>Signature <span class="token keyword">as</span> Verify<span class="token operator">></span><span class="token punctuation">::</span>Signer<span class="token punctuation">;</span>
  <span class="token keyword">type</span> Signature <span class="token operator">=</span> Signature<span class="token punctuation">;</span>

  <span class="token keyword">fn</span> create_transaction<span class="token operator">&lt;</span>TSigner<span class="token punctuation">:</span> system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span>Signer<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span>Public<span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span>Signature<span class="token operator">>></span> <span class="token punctuation">(</span>
    call<span class="token punctuation">:</span> Call<span class="token punctuation">,</span>
    public<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">::</span>Public<span class="token punctuation">,</span>
    account<span class="token punctuation">:</span> AccountId<span class="token punctuation">,</span>
    index<span class="token punctuation">:</span> Index<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span><span class="token punctuation">(</span>Call<span class="token punctuation">,</span> <span class="token operator">&lt;</span>UncheckedExtrinsic <span class="token keyword">as</span> sp_runtime<span class="token punctuation">::</span>traits<span class="token punctuation">::</span>Extrinsic<span class="token operator">></span><span class="token punctuation">::</span>SignaturePayload<span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> period <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> current_block <span class="token operator">=</span> System<span class="token punctuation">::</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saturated_into<span class="token punctuation">::</span><span class="token operator">&lt;</span>u64<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tip <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> extra<span class="token punctuation">:</span> SignedExtra <span class="token operator">=</span> <span class="token punctuation">(</span>
      system<span class="token punctuation">::</span>CheckVersion<span class="token punctuation">::</span><span class="token operator">&lt;</span>Runtime<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      system<span class="token punctuation">::</span>CheckGenesis<span class="token punctuation">::</span><span class="token operator">&lt;</span>Runtime<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      system<span class="token punctuation">::</span>CheckEra<span class="token punctuation">::</span><span class="token operator">&lt;</span>Runtime<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>generic<span class="token punctuation">::</span>Era<span class="token punctuation">::</span><span class="token function">mortal</span><span class="token punctuation">(</span>period<span class="token punctuation">,</span> current_block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      system<span class="token punctuation">::</span>CheckNonce<span class="token punctuation">::</span><span class="token operator">&lt;</span>Runtime<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
      system<span class="token punctuation">::</span>CheckWeight<span class="token punctuation">::</span><span class="token operator">&lt;</span>Runtime<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      transaction_payment<span class="token punctuation">::</span>ChargeTransactionPayment<span class="token punctuation">::</span><span class="token operator">&lt;</span>Runtime<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> raw_payload <span class="token operator">=</span> SignedPayload<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>call<span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> signature <span class="token operator">=</span> TSigner<span class="token punctuation">::</span><span class="token function">sign</span><span class="token punctuation">(</span>public<span class="token punctuation">,</span> <span class="token operator">&amp;</span>raw_payload<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> address <span class="token operator">=</span> Indices<span class="token punctuation">::</span><span class="token function">unlookup</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>call<span class="token punctuation">,</span> extra<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> raw_payload<span class="token punctuation">.</span><span class="token function">deconstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>call<span class="token punctuation">,</span> <span class="token punctuation">(</span>address<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在宏 <code>contrast_runtime!</code> 中，将所有不同的 pallet 作为 runtime 的一部分。 如果在链下工作机中使用未签名的交易，则添加另外一个参数 <code>ValidateUnsigned</code>。 You will need to write custom <a href="../learn-substrate/extrinsics">validation logic</a> for this.</p>
<pre><code class="hljs css language-rust"><span class="token function">construct_runtime!</span><span class="token punctuation">(</span>
  <span class="token keyword">pub</span> <span class="token keyword">enum</span> Runtime <span class="token keyword">where</span>
    Block <span class="token operator">=</span> Block<span class="token punctuation">,</span>
    NodeBlock <span class="token operator">=</span> opaque<span class="token punctuation">::</span>Block<span class="token punctuation">,</span>
    UncheckedExtrinsic <span class="token operator">=</span> UncheckedExtrinsic
  <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>

    <span class="token comment">// 使用未签名交易</span>
    OffchainPallet<span class="token punctuation">:</span> offchain_pallet<span class="token punctuation">::</span><span class="token punctuation">{</span> Module<span class="token punctuation">,</span> Call<span class="token punctuation">,</span> Storage<span class="token punctuation">,</span> Event<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">,</span> transaction_validity<span class="token punctuation">::</span>ValidateUnsigned <span class="token punctuation">}</span>

    <span class="token comment">// 使用签名交易</span>
    <span class="token comment">// OffchainPallet: offchain_pallet::{ Module, Call, Storage, Event&lt;T> }</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="在-servicers-中添加密钥（keys）"></a><a href="#在-servicers-中添加密钥（keys）" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 <code>service.rs</code> 中添加密钥（Keys）</h2>
<p>使用 <code>KeyTypeId</code> 指定本地密钥库来存储应用特定的密钥，链下工作机可以访问这些密钥来签署交易。 需要通过以下两种方式之一添加密钥。</p>
<h3><a class="anchor" aria-hidden="true" id="选项-1（开发阶段）：添加第一个用户密钥作为应用子密钥"></a><a href="#选项-1（开发阶段）：添加第一个用户密钥作为应用子密钥" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选项 1（开发阶段）：添加第一个用户密钥作为应用子密钥</h3>
<p>在开发环境中，可以添加第一个用户的密钥作为应用子密钥。 更新 <code>node/src/service.rs</code> 如下所示。</p>
<pre><code class="hljs css language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> new_full<span class="token operator">&lt;</span>C<span class="token punctuation">:</span> Send <span class="token operator">+</span> Default <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'static</span><span class="token operator">></span><span class="token punctuation">(</span>config<span class="token punctuation">:</span> Configuration<span class="token operator">&lt;</span>C<span class="token punctuation">,</span> GenesisConfig<span class="token operator">></span><span class="token punctuation">)</span>
  <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span><span class="token keyword">impl</span> AbstractService<span class="token punctuation">,</span> ServiceError<span class="token operator">></span>
<span class="token punctuation">{</span>
  <span class="token comment">// --snip--</span>

  <span class="token comment">// 给Alice clone 密钥</span>
  <span class="token keyword">let</span> dev_seed <span class="token operator">=</span> config<span class="token punctuation">.</span>dev_key_seed<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// --snip--</span>

  <span class="token keyword">let</span> service <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">with_network_protocol</span><span class="token punctuation">(</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token function">Ok</span><span class="token punctuation">(</span>NodeProtocol<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">with_finality_proof_provider</span><span class="token punctuation">(</span><span class="token operator">|</span>client<span class="token punctuation">,</span> backend<span class="token operator">|</span>
      <span class="token function">Ok</span><span class="token punctuation">(</span>Arc<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>GrandpaFinalityProofProvider<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>backend<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> _<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token comment">// 添加以下部分以添加密钥到 keystore</span>
  <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span> <span class="token operator">=</span> dev_seed <span class="token punctuation">{</span>
    service
      <span class="token punctuation">.</span><span class="token function">keystore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>insert_ephemeral_from_seed_by_type<span class="token punctuation">::</span><span class="token operator">&lt;</span>runtime<span class="token punctuation">::</span>offchain_pallet<span class="token punctuation">::</span>crypto<span class="token punctuation">::</span>Pair<span class="token operator">></span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>seed<span class="token punctuation">,</span>
        runtime<span class="token punctuation">::</span>offchain_pallet<span class="token punctuation">::</span>KEY_TYPE<span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Dev Seed should always succeed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这样就可以签名交易了。 这仅对 <strong>开发阶段</strong> 有利。</p>
<h3><a class="anchor" aria-hidden="true" id="选项2：通过-cli-添加应用子密钥"></a><a href="#选项2：通过-cli-添加应用子密钥" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选项2：通过 CLI 添加应用子密钥</h3>
<p>在更实际的环境中，在设置 Substrate 节点后，可以通过命令行接口添加一个新的应用子密钥。如下所示：</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Generate a new account</span>
$ subkey -s generate

<span class="hljs-comment"># Submit a new key via RPC</span>
$ curl http://localhost:9933 -H <span class="hljs-string">"Content-Type:application/json;charset=utf-8"</span> -d \
  <span class="hljs-string">'{
    "jsonrpc":"2.0",
    "id":1,
    "method":"author_insertKey",
    "params": [
      "&lt;YourKeyTypeId&gt;",
      "&lt;YourSeedPhrase&gt;",
      "&lt;YourPublicKey&gt;"
    ]
  }'</span>
</code></pre>
<p>If you enter the command and parameters correctly, the node will return a JSON response as follows.</p>
<pre><code class="hljs css language-json">{ <span class="hljs-attr">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>, <span class="hljs-attr">"result"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span> }
</code></pre>
<p>A new key is now added in the local keystore.</p>
<h2><a class="anchor" aria-hidden="true" id="已签名交易"></a><a href="#已签名交易" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>已签名交易</h2>
<p>Now you are ready to to make a signed transaction from the off-chain worker. Go back to your pallet in <code>my_offchain_worker.rs</code>.</p>
<pre><code class="hljs css language-rust"><span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">enum</span> Call <span class="token keyword">where</span> origin<span class="token punctuation">:</span> T<span class="token punctuation">::</span>Origin <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">onchain_callback</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> _block<span class="token punctuation">:</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">,</span> input<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> dispatch<span class="token punctuation">::</span>Result <span class="token punctuation">{</span>
      <span class="token keyword">let</span> who <span class="token operator">=</span> <span class="token function">ensure_signed</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
      debug<span class="token punctuation">::</span><span class="token function">info!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> core<span class="token punctuation">::</span>str<span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">offchain_worker</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Here we specify the function to be called back on-chain in next block import.</span>
      <span class="token keyword">let</span> call <span class="token operator">=</span> Call<span class="token punctuation">::</span><span class="token function">onchain_callback</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token string">b"hello world!"</span><span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      T<span class="token punctuation">::</span>SubmitSignedTransaction<span class="token punctuation">::</span><span class="token function">submit_signed</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>After having defined the on-chain callback function, in the off-chain worker you can specify that function to be called back in the next block import phase. You then submit a signed transaction to the node.</p>
<p>If you look at the implementation of <code>fn system::offchain::submit_signed</code> in the <a href="https://github.com/paritytech/substrate/blob/a98625501be68cc3084e666497c16b111741dded/frame/system/src/offchain.rs#L106-L115">Substrate codebase</a>, you will see it is calling the on-chain callback for each key in the local keystore. But since you only have one key in the local keystore now, you are calling the function only once.</p>
<p><a href="../learn-substrate/extrinsics#signed-transactions">Learn more about Signed Transactions</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="未签名交易"></a><a href="#未签名交易" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未签名交易</h2>
<p>With the following code, you are able to send an unsigned transaction back to the chain.</p>
<pre><code class="hljs css language-rust"><span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">enum</span> Call <span class="token keyword">where</span> origin<span class="token punctuation">:</span> T<span class="token punctuation">::</span>Origin <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">onchain_callback</span><span class="token punctuation">(</span>_origin<span class="token punctuation">,</span> _block<span class="token punctuation">:</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">,</span> input<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> dispatch<span class="token punctuation">::</span>Result <span class="token punctuation">{</span>
      debug<span class="token punctuation">::</span><span class="token function">info!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> core<span class="token punctuation">::</span>str<span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">offchain_worker</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Here we specify the function to be called back on-chain in next block import.</span>
      <span class="token keyword">let</span> call <span class="token operator">=</span> Call<span class="token punctuation">::</span><span class="token function">onchain_callback</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token string">b"hello world!"</span><span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      T<span class="token punctuation">::</span>SubmitUnsignedTransaction<span class="token punctuation">::</span><span class="token function">submit_unsigned</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>By default, all unsigned transactions are treated as invalid transactions. You need to add the following code piece in <code>my_offchain_worker.rs</code> to explicitly allow submitting unsigned transactions.</p>
<pre><code class="hljs css language-rust"><span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
  <span class="token comment">// --snip--</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> Module<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// --snip--</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[allow(deprecated)]</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> support<span class="token punctuation">::</span>unsigned<span class="token punctuation">::</span>ValidateUnsigned <span class="token keyword">for</span> Module<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> Call <span class="token operator">=</span> Call<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">;</span>

  <span class="token keyword">fn</span> <span class="token function">validate_unsigned</span><span class="token punctuation">(</span>call<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span>Call<span class="token punctuation">)</span> <span class="token punctuation">-></span> TransactionValidity <span class="token punctuation">{</span>

    <span class="token keyword">match</span> call <span class="token punctuation">{</span>
      Call<span class="token punctuation">::</span><span class="token function">onchain_callback</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> input<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Ok</span><span class="token punctuation">(</span>ValidTransaction <span class="token punctuation">{</span>
        priority<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        requires<span class="token punctuation">:</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        provides<span class="token punctuation">:</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        longevity<span class="token punctuation">:</span> TransactionLongevity<span class="token punctuation">::</span><span class="token function">max_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        propagate<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      _ <span class="token operator">=></span> InvalidTransaction<span class="token punctuation">::</span>Call<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We add a <code>deprecated</code> attribute to prevent warning messages from being displayed. It is because this part of the API is still in transition and will be updated in coming Substrate release. Please use this with caution for now.</p>
<p><a href="../learn-substrate/extrinsics#unsigned-transactions">Learn more about Unsigned Transactions</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="链上回调函数中的参数"></a><a href="#链上回调函数中的参数" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>链上回调函数中的参数</h2>
<p>When making an on-chain callback, our implementation hashes the function name together with all of its parameter values. The callback will be stored and called during the next block import. If we find that the hash value exists, meaning a function with the same set of parameters has been called before, then for signed transactions the function will be replaced if called with a higher priority; for unsigned transactions this callback is simply ignored.</p>
<p>If your pallet is making on-chain callbacks regularly and you expect it to have a duplicate set of parameters occassionally, you can always pass in an additional parameter of the current block number that is passed in from the <code>offchain_worker</code> function. This number will only increment and is guaranteed to be unique.</p>
<h2><a class="anchor" aria-hidden="true" id="获取外部数据"></a><a href="#获取外部数据" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取外部数据</h2>
<p>To fetch external data from third-party APIs, use the <code>offchain::http</code> library in <code>my_offchain_worker.rs</code> as follows.</p>
<pre><code class="hljs css language-rust"><span class="token keyword">use</span> sp_runtime<span class="token punctuation">::</span><span class="token punctuation">{</span>
  offchain<span class="token punctuation">::</span>http<span class="token punctuation">,</span>
  transaction_validity<span class="token punctuation">::</span><span class="token punctuation">{</span>
    TransactionValidity<span class="token punctuation">,</span> TransactionLongevity<span class="token punctuation">,</span> ValidTransaction<span class="token punctuation">,</span> InvalidTransaction
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// --snip--</span>

<span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">enum</span> Call <span class="token keyword">where</span> origin<span class="token punctuation">:</span> T<span class="token punctuation">::</span>Origin <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>
    <span class="token keyword">fn</span> <span class="token function">offchain_worker</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">match</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">fetch_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Ok</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> debug<span class="token punctuation">::</span><span class="token function">info!</span><span class="token punctuation">(</span><span class="token string">"Result: {}"</span><span class="token punctuation">,</span> core<span class="token punctuation">::</span>str<span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> debug<span class="token punctuation">::</span><span class="token function">error!</span><span class="token punctuation">(</span><span class="token string">"Error fetch_data: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> Module<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function">fetch_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> str<span class="token operator">></span> <span class="token punctuation">{</span>

    <span class="token comment">// Specifying the request</span>
    <span class="token keyword">let</span> pending <span class="token operator">=</span> http<span class="token punctuation">::</span>Request<span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"https://min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token string">"Error in sending http GET request"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Waiting for the response</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> pending<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token string">"Error in waiting http response back"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Check if the HTTP response is okay</span>
    <span class="token keyword">if</span> response<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token number">200</span> <span class="token punctuation">{</span>
      debug<span class="token punctuation">::</span><span class="token function">warn!</span><span class="token punctuation">(</span><span class="token string">"Unexpected status code: {}"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">Err</span><span class="token punctuation">(</span><span class="token string">"Non-200 status code returned from http request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Collect the result in the form of bytes</span>
    <span class="token function">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">::</span><span class="token operator">&lt;</span>Vec<span class="token operator">&lt;</span>u8<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You likely need to parse the result in JSON format afterwards. We have <a href="https://github.com/jimmychu0807/substrate-offchain-pricefetch/blob/047ad8094dc21e2bced2d055707756265be32e95/node/runtime/src/price_fetch.rs#L250-L260">an example here</a> using an external library to parse the JSON result in a <code>no_std</code> environment.</p>
<!--
[comment]: # (TODO: Signing Transactions with Session Keys)
[comment]: # (TODO: Local Key-Value Database)
[comment]: # (TODO: Writing Tests)
-->
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<h3><a class="anchor" aria-hidden="true" id="learn-more"></a><a href="#learn-more" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Learn More</h3>
<ul>
<li><a href="../learn-substrate/extrinsics#signed-transactions">已签名交易</a></li>
<li><a href="../learn-substrate/extrinsics#unsigned-transactions">未签名交易</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h3>
<ul>
<li><a href="https://github.com/tomusdrw/sub0-offchain-workshop">Sub0 工作坊链下工作机的资料</a></li>
<li><a href="https://github.com/jimmychu0807/substrate-offchain-pricefetch">链下工作机价格获取</a></li>
<li>(Deprecated) <a href="https://github.com/gnunicorn/substrate-offchain-cb">Off-chain worker callback using Substrate v1 API</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="references"></a><a href="#references" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h3>
<ul>
<li>Substrate <a href="https://github.com/paritytech/substrate/blob/master/frame/im-online/src/lib.rs"><code>im-online</code> module</a>, a pallet inside Substrate using off-chain workers to notify other nodes that a validator in the network is online.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/knowledgebase/runtime/fees"><span class="arrow-prev">← </span><span>交易费用</span></a><a class="docs-next button" href="/docs/zh-CN/knowledgebase/runtime/debugging"><span>Debugging</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#在-runtime-中使用链下工作机">在 Runtime 中使用链下工作机</a></li><li><a href="#在-servicers-中添加密钥（keys）">在 <code>service.rs</code> 中添加密钥（Keys）</a><ul class="toc-headings"><li><a href="#选项-1（开发阶段）：添加第一个用户密钥作为应用子密钥">选项 1（开发阶段）：添加第一个用户密钥作为应用子密钥</a></li><li><a href="#选项2：通过-cli-添加应用子密钥">选项2：通过 CLI 添加应用子密钥</a></li></ul></li><li><a href="#已签名交易">已签名交易</a></li><li><a href="#未签名交易">未签名交易</a></li><li><a href="#链上回调函数中的参数">链上回调函数中的参数</a></li><li><a href="#获取外部数据">获取外部数据</a></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#learn-more">Learn More</a></li><li><a href="#examples">Examples</a></li><li><a href="#references">References</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/zh-CN/getting-started">Getting Started</a><a href="/zh-CN/tutorials">Tutorials</a><a href="https://crates.parity.io/">Reference Docs</a><a href="/recipes/">Recipes</a></div><div><h5>Community</h5><a href="/zh-CN/videos">Videos</a><a href="/zh-CN/seminar">Substrate Seminar</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://builders.parity.io/">Substrate Builders Program</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="#" id="cookie-settings">Cookie Settings<script>
              var cookieSettings = document.getElementById('cookie-settings');
              cookieSettings.onclick = function() {
                return klaro.show();
              };
              </script></a></div></section><section class="copyright">Copyright © 2020 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>