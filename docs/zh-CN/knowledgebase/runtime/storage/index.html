<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Runtime 存储 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Runtime存储机制可使数据持久地存储在区块链中，并在runtime逻辑中能够被访问。 “存储应该是区块链runtime开发人员最为关注的点之一”， 这种说法不言自明，因为区块链的主要目标之一就是为底层存储状态提供去中心化共识。 此外，设计良好的存储系统可减少网络中节点的负载，从而降低区块链参与者的开销。 Substrate提供了分层的模块化存储API，使runtime开发人员能根据自身情况作出合适的存储决策。 但同时请记住，区块链runtime存储的基本原则是尽可能少的使用链上存储。 本文旨在提供有关Substrate runtime存储接口的相关信息和最佳实践， 如果想知道这些接口如何实现，请参阅 [进阶存储文档](../advanced/storage)。"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="Runtime 存储 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="Runtime存储机制可使数据持久地存储在区块链中，并在runtime逻辑中能够被访问。 “存储应该是区块链runtime开发人员最为关注的点之一”， 这种说法不言自明，因为区块链的主要目标之一就是为底层存储状态提供去中心化共识。 此外，设计良好的存储系统可减少网络中节点的负载，从而降低区块链参与者的开销。 Substrate提供了分层的模块化存储API，使runtime开发人员能根据自身情况作出合适的存储决策。 但同时请记住，区块链runtime存储的基本原则是尽可能少的使用链上存储。 本文旨在提供有关Substrate runtime存储接口的相关信息和最佳实践， 如果想知道这些接口如何实现，请参阅 [进阶存储文档](../advanced/storage)。"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/redirect-next.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class="siteNavGroupActive"><a href="/docs/zh-CN/" target="_self">知识库</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">进阶菜谱</a></li><li class=""><a href="https://substrate.dev/rustdocs/" target="_self">API 文档</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/knowledgebase/runtime/storage">English</a></li><li><a href="/docs/ru/knowledgebase/runtime/storage">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">协助翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Runtime</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">开始<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/">总览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/">安装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/windows-users">在 Windows 系统开始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/glossary">词汇表</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">学习 Substrate<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/tx-pool">交易池</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/account-abstractions">账户摘要</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/session-keys">会话密钥</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/weight">交易权重</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/off-chain-workers">链下工作机</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Runtime<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/">Runtime 总览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/primitives">Runtime 的基本类型</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/frame">FRAME</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/pallets">Pallets</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/macros">Runtime宏</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/metadata">Runtime 元数据</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/storage">Runtime 存储</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/origin">Runtime 来源</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/execution">Runtime 执行流程</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/events">Runtime事件</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/errors">Runtime 错误</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/fees">交易费用</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/off-chain-workers">链下工作机</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/debugging">调试</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/tests">Runtime 测试</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/randomness">链上随机生成</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/upgrades">Runtime 升级</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">智能合约<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/overview">总览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/">ink! 智能合约</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/ink-fundamentals">ink! 概念</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/ink-development">ink! 开发</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/evm-pallet">EVM 模块</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/faq">ink! 常问问题</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">整合<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/polkadot-js">Polkadot-JS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/libraries">客户端库</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/chain-spec">链描述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/subkey">Subkey 工具</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/memory-profiling">内存分析</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">进阶<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/codec">SCALE 编解码器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/consensus">共识机制</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/block-import">区块导入过程</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/executor">执行器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/cryptography">密码学</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/storage">存储</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/ss58-address-format">SS58 地址格式</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">贡献<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/contribute/help-translate">协助翻译</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">Runtime 存储</h1></header><article><div><span><p>Runtime存储机制可使数据持久地存储在区块链中，并在runtime逻辑中能够被访问。 “存储应该是区块链runtime开发人员最为关注的点之一”， 这种说法不言自明，因为区块链的主要目标之一就是为底层存储状态提供去中心化共识。 此外，设计良好的存储系统可减少网络中节点的负载，从而降低区块链参与者的开销。 Substrate提供了分层的模块化存储API，使runtime开发人员能根据自身情况作出合适的存储决策。 但同时请记住，区块链runtime存储的基本原则是尽可能少的使用链上存储。 本文旨在提供有关Substrate runtime存储接口的相关信息和最佳实践， 如果想知道这些接口如何实现，请参阅 <a href="../advanced/storage">进阶存储文档</a>。</p>
<h2><a class="anchor" aria-hidden="true" id="存储项"></a><a href="#存储项" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>存储项</h2>
<p><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/index.html">FRAME support</a>中的<code>storage</code> 模块使得runtime开发人员可以灵活地访问Substrate的存储API。 只要是<a href="../advanced/codec">Parity SCALE codec</a>编码支持的值都可以传入到存储API中：</p>
<ul>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html">Storage Value</a> - 单一的值</li>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html">Storage Map</a> - 一组键值对哈希映射</li>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageDoubleMap.html">Storage Double Map</a> - 实现了两个键的映射，它提供了有效地删除第一个键相同的所有条目的重要功能。</li>
</ul>
<p>存储项类型的选择应取决于runtime使用该值的逻辑方式。</p>
<h3><a class="anchor" aria-hidden="true" id="storage-value"></a><a href="#storage-value" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage Value</h3>
<p>如果一个值需要在runtime里被视作为一个整体，则应该选用这种存储项类型，它可以是一个基础类型值、一个<code>结构体</code>，或者是相关项的一个集合。 尽管将相关项包裹在一个共享<code>结构体</code> 中，是减少存储读取次数的绝佳方法(非常重要的考虑因素)，但当这个结构体的大小增长到一定程度时，它的使用成本可能远远超过存储读取次数减少所带来的好处。 Storage values 也可用来存储集合，但runtime开发人员应当非常注意集合的大小。 因为大型集合产生的存储成本就像大型的 <code>结构体</code>一样高。 此外，如果在runtime中迭代大型的列表，可能会导致处理时间超出区块生产时间 - 如果发生这种情况，区块链将停止产生区块，也就相当于区块链停止运行了。</p>
<h4><a class="anchor" aria-hidden="true" id="方法"></a><a href="#方法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法</h4>
<p>请参阅 Storage Value 的相关文档以获取 <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html#required-methods"> Storage Values 对外暴露的完整方法列表 </a>。 下面总结了其中一些最重要的方法：</p>
<ul>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html#tymethod.get"><code>get()</code></a> - 从存储中读取值。</li>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html#tymethod.put"><code>put(val)</code></a> - 存储提供的值。</li>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html#tymethod.mutate"><code>mutate(fn)</code></a> - 使用提供的函数修改值。</li>
<li><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html#tymethod.take"><code>take()</code></a> - 加载值并把它从存储中移除。</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="storage-maps"></a><a href="#storage-maps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage Maps</h3>
<p>映射数据结构非常适合管理随机访问的项目集，但并不适用于管理需要顺序遍历的项目集。 Substrate中的 Storage Maps 通过键值对哈希映射来实现，这是大多数开发人员都熟悉的模式。 为了给予区块链工程师更多的控制权，Substrate允许开发人员选择用于生成map中的key的<a href="#hashing-algorithms">哈希算法</a>。 请参阅<a href="../advanced/storage">进阶存储文档</a>，以了解更多关于如何实现Substrate的存储映射的信息。</p>
<h4><a class="anchor" aria-hidden="true" id="方法-1"></a><a href="#方法-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法</h4>
<p><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html#required-methods">Storage Maps 暴露了一系列 API</a> 与 Storage Values 的API很类似。</p>
<ul>
<li><code>get</code> - 从存储中查询对应key关联的值。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html#tymethod.get"><code>StorageMap#get(key)</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageDoubleMap.html#tymethod.get"><code>StorageDoubleMap#get(key1, key2)</code></a></li>
<li><code>insert</code> - 存储提供的值，并与给定键做关联。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html#tymethod.insert"><code>StorageMap#insert(key, val)</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageDoubleMap.html#tymethod.insert"><code>StorageDoubleMap#insert(key1, key2, val)</code></a></li>
<li><code>mutate</code> - 使用提供的函数来更改与给定键关联的值。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html#tymethod.mutate"><code>StorageMap#mutate(key, fn)</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageDoubleMap.html#tymethod.mutate"><code>StorageDoubleMap#mutate(key1, key2, fn)</code></a></li>
<li><code>take</code> - 加载与给定键关联的值，并将其从存储中删除。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html#tymethod.take"><code>StorageMap#take(key)</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageDoubleMap.html#tymethod.take"><code>StorageDoubleMap#take(key1, key2)</code></a></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="iterable-storage-maps"></a><a href="#iterable-storage-maps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Iterable Storage Maps</h4>
<p>Substrate Storage Maps 可以遍历键和值。 由于映射通常用于存储无大小约束的数据集(例如帐户余额)，如果在runtime中对整个映射进行遍历，很容易超出区块生产时间。 此外，与访问本地列表元素相比，访问映射的元素需要更多数据库读取操作，因此遍历映射的时间明显比遍历列表的时间要&lt;em x-id =“ 4”&gt;多得多</em> 。 这并不是说在runtime中遍历映射是“错误的”。Substrate主要想表达的是&quot;<a href="#best-practices">首要原则</a>&quot;，而不是简单粗暴的对与错。 区块链runtime的高效是Substrate的首要原则之一，这些信息旨在帮助您了解&lt;em x-id =“ 4”&gt;所有</em> Substrate的存储功能，并帮助你在坚持首要原则的基础上使用这些功能。</p>
<h5><a class="anchor" aria-hidden="true" id="iterable-storage-map-methods"></a><a href="#iterable-storage-map-methods" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Iterable Storage Map Methods</h5>
<p>Substrate的 Iterable Storage Map 接口定义了如下方法。 要注意的是，在 Iterable Storage Double Map 中，<code>iter</code> 和 <code>drain</code>方法要求传入一个参数，即第一个键：</p>
<ul>
<li><code>iter</code> - 不按特定顺序枚举出映射中所有的元素。 如果在遍历映射时同时修改映射，则会返回异常结果。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.IterableStorageMap.html#tymethod.iter"><code>IterableStorageMap#iter()</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.IterableStorageDoubleMap.html#tymethod.iter"><code>IterableStorageDoubleMap#iter(key1)</code></a></li>
<li><code>drain</code> - 从映射中移除所有元素，并以不固定的顺序遍历它们。 如果在运行drain方法时同时给映射增加新元素，则会返回未知结果。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.IterableStorageMap.html#tymethod.drain"><code>IterableStorageMap#drain()</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.IterableStorageDoubleMap.html#tymethod.drain"><code>IterableStorageDoubleMap#drain(key1)</code></a></li>
<li><code>translate</code> - 使用提供的函数并以不特定顺序来转换映射中的所有元素。 如果想从 map 里删除一个元素，则需要在 translation 函数内返回 <code>None</code>。 Docs: <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.IterableStorageMap.html#tymethod.translate"><code>IterableStorageMap#translate(fn)</code></a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.IterableStorageDoubleMap.html#tymethod.translate"><code>IterableStorageDoubleMap#translate(fn)</code></a></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="哈希算法"></a><a href="#哈希算法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>哈希算法</h4>
<p>如上文所述，Substrate Storage Maps 的一个特性是，允许开发人员指定生成map中的key的哈希算法。 用于封装哈希计算逻辑的Rust对象称为&quot;hasher&quot;。 广义上讲，可以用两种方式来描述供Substrate开发人员使用的&quot;hasher&quot;：它们是否是密码学安全的，以及它们是否产生透明的输出。 为了完整起见，下文也会介绍非透明哈希算法的特征。但是请记住，我们不推荐在基于FRAME打造的区块链内使用任何产生不透明输出的哈希算法。</p>
<h5><a class="anchor" aria-hidden="true" id="加密哈希算法"></a><a href="#加密哈希算法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加密哈希算法</h5>
<p>加密哈希算法的原理，是使用密码学来减少通过控制输入内容以对输出结果施加影响的情况。 举个例子，即使输入只有简单的数字如1-10，加密哈希算法也会产生广泛分布的输出。 因此，在用户能控制存储映射键的情况下，使用加密哈希算法尤其重要。 否则，可能存在潜在的攻击载体，很容易被作恶者利用，来降低区块链网络的性能。 其中一个推荐用加密哈希算法生成映射键的情景，就是用映射追踪用户余额。 这种情景下使用加密哈希算法尤其重要，这样攻击者就无法通过向多个连续帐号进行小额转账来轰炸系统。 而如果没有加密哈希算法，因此产生的不平衡存储结构将会影响系统性能。 但加密哈希算法比非加密哈希算法更复杂且耗费资源更多，这就是为什么Substrate允许开发人员自由选择何时使用它们的原因。</p>
<h5><a class="anchor" aria-hidden="true" id="透明哈希算法"></a><a href="#透明哈希算法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>透明哈希算法</h5>
<p>透明哈希算法是在给定输出结果的情况下，用于挖掘和验证输入内容的简单算法。 Substrate通过将算法的输入与其输出结果相连接，使哈希算法变得透明。 这使得用户可以很容易的获取key对应的原始未哈希的值和通过重新哈希来验证它。 Substrate的核心开发人员在基于FRAME的runtime中，已经<strong>废弃了不透明哈希算法的使用</strong>，此处的内容主要是出于完整性的考虑而呈现。 实际上，如果要获得<a href="#iterable-storage-maps">iterable map</a>的功能，则<em>必须</em>使用透明的哈希算法。 请参阅<a href="../advanced/storage#storage-map-keys">进阶存储文档</a> 以了解更多关于透明哈希算法的重要功能。</p>
<h5><a class="anchor" aria-hidden="true" id="常见的substrate哈希算法"></a><a href="#常见的substrate哈希算法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常见的Substrate哈希算法</h5>
<p>下表列出了Substrate中使用的一些常见哈希算法，并指出了哪些是加密的和透明的：</p>
<table>
<thead>
<tr><th>Hasher</th><th>密码学安全</th><th>是否透明</th></tr>
</thead>
<tbody>
<tr><td><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/struct.Blake2_128Concat.html">Blake2 128 Concat</a></td><td>X</td><td>X</td></tr>
<tr><td><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/struct.Twox64Concat.html">TwoX 64 Concat</a></td><td></td><td>X</td></tr>
<tr><td><a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/struct.Identity.html">Identity</a></td><td></td><td>X</td></tr>
</tbody>
</table>
<p>Identity hasher封装了这样一个哈希算法，该算法的输出等于其输入(identity函数)。 只有当key已经是加密哈希值时，才使用此类型的hasher。</p>
<h2><a class="anchor" aria-hidden="true" id="声明存储项"></a><a href="#声明存储项" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>声明存储项</h2>
<p>可使用<a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/macro.decl_storage.html"><code>decl_storage</code> 宏</a>轻松创建新的runtime存储项。 以下示例可展示了如何声明每种类型的存储项：</p>
<pre><code class="hljs css language-rust"><span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> <span class="token class-name">Store</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
        <span class="token class-name">SomePrivateValue</span><span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
        <span class="token keyword">pub</span> <span class="token class-name">SomePrimitiveValue</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token function-definition function">some_primitive_value</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
        <span class="token comment">// types can make use of the generic `T: Trait`</span>
        <span class="token keyword">pub</span> <span class="token class-name">SomeComplexValue</span><span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span><span class="token punctuation">;</span>
        <span class="token keyword">pub</span> <span class="token class-name">SomeMap</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token function-definition function">some_map</span><span class="token punctuation">)</span><span class="token punctuation">:</span> map <span class="token function">hasher</span><span class="token punctuation">(</span>blake2_128_concat<span class="token punctuation">)</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span> <span class="token operator">=></span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
        <span class="token keyword">pub</span> <span class="token class-name">SomeDoubleMap</span><span class="token punctuation">:</span> double_map <span class="token function">hasher</span><span class="token punctuation">(</span>blake2_128_concat<span class="token punctuation">)</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token function">hasher</span><span class="token punctuation">(</span>blake2_128_concat<span class="token punctuation">)</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span> <span class="token operator">=></span> <span class="token keyword">u32</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>请注意，映射的存储项指定了将要使用的<a href="#hashing-algorithms">哈希算法</a>。</p>
<h3><a class="anchor" aria-hidden="true" id="可见性"></a><a href="#可见性" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可见性</h3>
<p>In the example above, all the storage items except <code>SomePrivateValue</code> are made public by way of the <code>pub</code> keyword. Blockchain storage is always publicly <a href="#accessing-storage-items">visible from <em>outside</em> of the runtime</a>; the visibility of Substrate storage items only impacts whether or not other pallets <em>within</em> the runtime will be able to access a storage item.</p>
<h3><a class="anchor" aria-hidden="true" id="getter方法"></a><a href="#getter方法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getter方法</h3>
<p>The <code>decl_storage</code> macro provides an optional <code>get</code> extension that can be used to implement a getter method for a storage item on the module that contains that storage item; the extension takes the desired name of the getter function as an argument. If you omit this optional extension, you will still be able to access the storage item's value, but you will not be able to do so by way of a getter method implemented on the module; instead, you will need to use <a href="#methods">the storage item's <code>get</code> method</a>. Keep in mind that the optional <code>get</code> extension only impacts the way that the storage item can be accessed from within Substrate code; you will always be able to <a href="../advanced/storage#Querying-Storage">query the storage of your runtime</a> to get the value of a storage item.</p>
<p>Here is an example that implements a getter method named <code>some_value</code> for a Storage Value named <code>SomeValue</code>. This module would now have access to a <code>Self::some_value()</code> method in addition to the <code>SomeValue::get()</code> method:</p>
<pre><code class="hljs css language-rust"><span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> <span class="token class-name">Store</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token class-name">SomeValue</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token function-definition function">some_value</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="缺省值"></a><a href="#缺省值" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺省值</h3>
<p>Substrate allows you to specify a default value that is returned when a storage item's value is not set. The default value does <strong>not</strong> actually occupy runtime storage, but runtime logic will see this value during execution.</p>
<p>Here is an example of specifying the default value for all items in a map:</p>
<pre><code class="hljs css language-rust"><span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> <span class="token class-name">Store</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token class-name">SomeMap</span><span class="token punctuation">:</span> map <span class="token keyword">u64</span> <span class="token operator">=></span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">1337</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="创世配置"></a><a href="#创世配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创世配置</h3>
<p>Substrate's runtime storage APIs include capabilities to initialize storage items in the genesis block of your blockchain. The genesis storage configuration APIs expose a number of mechanisms for initializing storage, all of which have entry points in the <code>decl_storage</code> macro. These mechanisms all result in the creation of a <code>GenesisConfig</code> data type that implements <a href="https://substrate.dev/rustdocs/v2.0.0/sp_runtime/trait.BuildModuleGenesisStorage.html">the <code>BuildModuleGenesisStorage</code> trait</a> and will be added to the module that contains the storage items (e.g. <a href="https://substrate.dev/rustdocs/v2.0.0/pallet_balances/struct.GenesisConfig.html"><code>Struct pallet_balances::GenesisConfig</code></a>); storage items that are tagged for genesis configuration will have a corresponding attribute on this data type. In order to consume a module's genesis configuration capabilities, you must include the <code>Config</code> element when adding the module to your runtime with <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/macro.construct_runtime.html">the <code>construct_runtime</code> macro</a>. All the <code>GenesisConfig</code> types for the modules that inform a runtime will be aggregated into a single <code>GenesisConfig</code> type for that runtime, which implements <a href="https://substrate.dev/rustdocs/v2.0.0/sp_runtime/trait.BuildStorage.html">the <code>BuildStorage</code> trait</a> (e.g. <a href="https://substrate.dev/rustdocs/v2.0.0/node_template_runtime/struct.GenesisConfig.html"><code>Struct node_template_runtime::GenesisConfig</code></a>); each attribute on this type corresponds to a <code>GenesisConfig</code> from one of the runtime's modules. Ultimately, the runtime's <code>GenesisConfig</code> is exposed by way of <a href="https://substrate.dev/rustdocs/v2.0.0/sc_chain_spec/trait.ChainSpec.html">the <code>ChainSpec</code> trait</a>. For a complete and concrete example of using Substrate's genesis storage configuration capabilities, refer to the <code>decl_storage</code> macro in <a href="https://github.com/paritytech/substrate/blob/master/frame/society/src/lib.rs">the Society pallet</a> as well as the genesis configuration for the Society pallet's storage in <a href="https://github.com/paritytech/substrate/blob/master/bin/node/cli/src/chain_spec.rs">the chain specification that ships with the Substrate code base</a>. Keep reading for more detailed descriptions of these capabilities.</p>
<h4><a class="anchor" aria-hidden="true" id="config"></a><a href="#config" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>config</code></h4>
<p>When you use the <code>decl_storage</code> macro to declare a storage item, you can provide an optional <code>config</code> extension that will add an attribute to the pallet's <code>GenesisConfig</code> data type; the value of this attribute will be used as the initial value of the storage item in your chain's genesis block. The <code>config</code> extension takes a parameter that will determine the name of the attribute on the <code>GenesisConfig</code> data type; this parameter is optional if <a href="#getter-methods">the <code>get</code> extension</a> is provided (the name of the <code>get</code> function is used as the attribute's name).</p>
<p>Here is an example that demonstrates using the <code>config</code> extension with a Storage Value named <code>MyVal</code> to create an attribute named <code>init_val</code> on the <code>GenesisConfig</code> data type for the Storage Value's module. This attribute is then used in an example that demonstrates using the <code>GenesisConfig</code> types to set the Storage Value's initial value in your chain's genesis block.</p>
<p>在 <code>my_module/src/lib.rs</code>中:</p>
<pre><code class="hljs css language-rust"><span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> <span class="token class-name">Store</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">MyModule</span> <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token class-name">MyVal</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token function-definition function">my_val</span><span class="token punctuation">)</span> <span class="token function">config</span><span class="token punctuation">(</span>init_val<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在 <code>chain_spec.rs</code>中:</p>
<pre><code class="hljs css language-rust"><span class="token class-name">GenesisConfig</span> <span class="token punctuation">{</span>
    my_module<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">MyModuleConfig</span> <span class="token punctuation">{</span>
        init_val<span class="token punctuation">:</span> <span class="token number">221u64</span> <span class="token operator">+</span> <span class="token constant">SOME_CONSTANT_VALUE</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="build"></a><a href="#build" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>build</code></h4>
<p>Whereas <a href="#config">the <code>config</code> extension</a> to the <code>decl_storage</code> macro allows you to configure a module's genesis storage state within a chain specification, the <code>build</code> extension allows you to perform this same task within the module itself (this gives you access to the module's private functions). Like <code>config</code>, the <code>build</code> extension accepts a single parameter, but in this case the parameter is always required and must be a closure, which is essentially a function. The <code>build</code> closure will be invoked with a single parameter whose type will be the pallet's <code>GenesisConfig</code> type (this gives you easy access to all the attributes of the <code>GenesisConfig</code> type). You may use the <code>build</code> extension along with the <code>config</code> extension for a single storage item; in this case, the pallet's <code>GenesisConfig</code> type will have an attribute that corresponds to what was set using <code>config</code> whose value will be set in the chain specification, but it will be the value returned by the <code>build</code> closure that will be used to set the storage item's genesis value.</p>
<p>Here is an example that demonstrates using <code>build</code> to set the initial value of a storage item. In this case, the example involves two storage items: one that represents a list of member account IDs and another that designates a special member from the list, the prime member. The list of members is provided by way of the <code>config</code> extension and the prime member, who is assumed to be the first element in the list of members, is set using the <code>build</code> extension.</p>
<p>在 <code>my_module/src/lib.rs</code>中:</p>
<pre><code class="hljs css language-rust"><span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> <span class="token class-name">Store</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">MyModule</span> <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token class-name">Members</span> <span class="token function">config</span><span class="token punctuation">(</span>orig_ids<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span><span class="token operator">></span><span class="token punctuation">;</span>
        <span class="token keyword">pub</span> <span class="token class-name">Prime</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>config<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">GenesisConfig</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span> config<span class="token punctuation">.</span>orig_ids<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在 <code>chain_spec.rs</code>中:</p>
<pre><code class="hljs css language-rust"><span class="token class-name">GenesisConfig</span> <span class="token punctuation">{</span>
    my_module<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">MyModuleConfig</span> <span class="token punctuation">{</span>
        orig_ids<span class="token punctuation">:</span> <span class="token constant">LIST_OF_IDS</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="add_extra_genesis"></a><a href="#add_extra_genesis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>add_extra_genesis</code></h4>
<p>The <code>add_extra_genesis</code> extension to the <code>decl_storage</code> macro allows you to define a scope where the <a href="#config"><code>config</code></a> and <a href="#build"><code>build</code></a> extensions can be provided without the need to bind them to specific storage items. You can use <code>config</code> within an <code>add_extra_genesis</code> scope to add an attribute to the pallet's <code>GenesisConfig</code> data type that can be used within any <code>build</code> closure. The <code>build</code> closures that are defined within an <code>add_extra_genesis</code> scope can be used to execute logic without binding that logic's return value to the value of a particular storage item; this may be desireable if you wish to invoke a private helper function within your module that sets several storage items or invoke a function defined on some other module included within your module.</p>
<p>Here is an example that encapsulates the same use case described above in the example for <code>build</code>: a module that maintains a list of member account IDs along with a designated prime member. In this case, however, the <code>add_extra_genesis</code> extension is used to define a <code>GenesisConfig</code> attribute that is not bound to particular storage item as well as a <code>build</code> closure that will call a private function on the module to set the values of multiple storage items. For the purposes of this example, the implementation of the private helper function (<code>initialize_members</code>) is left to your imagination.</p>
<p>在 <code>my_module/src/lib.rs</code>中:</p>
<pre><code class="hljs css language-js">decl_storage! {
    trait Store <span class="hljs-keyword">for</span> Module&lt;T: Trait&gt; <span class="hljs-keyword">as</span> MyModule {
        pub Members: Vec&lt;T::AccountId&gt;;
        pub Prime: T::AccountId;
    }
    add_extra_genesis {
        config(orig_ids): Vec&lt;T::AccountId&gt;;
        build(|config| Module::<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">T</span>&gt;</span>::initialize_members(&amp;config.members))
    }
}
</span></code></pre>
<p>在 <code>chain_spec.rs</code>中:</p>
<pre><code class="hljs css language-rust"><span class="token class-name">GenesisConfig</span> <span class="token punctuation">{</span>
    my_module<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">MyModuleConfig</span> <span class="token punctuation">{</span>
        orig_ids<span class="token punctuation">:</span> <span class="token constant">LIST_OF_IDS</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="访问存储项"></a><a href="#访问存储项" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>访问存储项</h2>
<p>Blockchains that are built with Substrate expose a remote procedure call (RPC) server that can be used to query your blockchain's runtime storage. You can use software libraries like <a href="https://polkadot.js.org/">Polkadot JS</a> to easily interact with the RPC server from your code and access storage items. The Polkadot JS team also maintains <a href="https://polkadot.js.org/apps">the Polkadot Apps UI</a>, which is a fully-featured web app for interacting with Substrate-based blockchains, including querying storage. Refer to <a href="../advanced/storage">the advanced storage documentation</a> to learn more about how Substrate uses a key-value database to implement the different kinds of storage items and how to query this database directly by way of the RPC server.</p>
<h2><a class="anchor" aria-hidden="true" id="最佳实践"></a><a href="#最佳实践" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳实践</h2>
<p>Substrate's goal is to provide a flexible framework that allows people to build the blockchain that suits their needs - the creators of Substrate tend not to think in terms of &quot;right&quot; or &quot;wrong&quot;. That being said, the Substrate codebase adheres to a number of best practices in order to promote the creation of blockchain networks that are secure, performant, and maintainable in the long-term. The following sections outline best practices for using Substrate storage and also describe the important first principles that motivated them.</p>
<h3><a class="anchor" aria-hidden="true" id="存储什么"></a><a href="#存储什么" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>存储什么</h3>
<p>Remember, the fundamental principle of blockchain runtime storage is to minimize its use. Only <em>consensus-critical</em> data should be stored in your runtime. When possible, use techniques like hashing to reduce the amount of data you must store. For instance, many of Substrate's governance capabilities (e.g. <a href="https://substrate.dev/rustdocs/v2.0.0/pallet_democracy/enum.Call.html#variant.propose">the Democracy pallet's <code>propose</code> dispatchable</a>) allow network participants to vote on the <em>hash</em> of a dispatchable call, which is always bounded in size, as opposed to the call itself, which may be unbounded in length. This is especially true in the case of runtime upgrades where the dispatchable call takes an entire runtime Wasm blob as its parameter. Because these governance mechanisms are implemented <em>on-chain</em>, all the information that is needed to come to consensus on the state of a given proposal must also be stored on-chain - this includes <em>what</em> is being voted on. However, by binding an on-chain proposal to its hash, Substrate's governance mechanisms allow this to be done in a way that defers bringing all the data associated with a proposal on-chain until <em>after</em> it has been approved. This means that storage is not wasted on proposals that fail. Once a proposal has passed, someone can initiate the actual dispatchable call (including all its parameters), which will be hashed and compared to the hash in the proposal. Another common pattern for using hashes to minimize data that is stored on-chain is to store the pre-image associated with an object in <a href="https://ipfs.io/">IPFS</a>; this means that only the IPFS location (a hash that is bounded in size) needs to be stored on-chain.</p>
<p>Hashes are only one mechanism that can be used to control the size of runtime storage. An example of another mechanism is <a href="#create-bounds">bounds</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="verify-first-write-last"></a><a href="#verify-first-write-last" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify First, Write Last</h3>
<p>Substrate does not cache state prior to extrinsic dispatch. Instead, it applies changes directly as they are invoked. If an extrinsic fails, any state changes will persist. Because of this, it is important not to make any storage mutations until it is certain that all preconditions have been met. In general, code blocks that may result in mutating storage should be structured as follows:</p>
<pre><code class="hljs css language-rust"><span class="token punctuation">{</span>
  <span class="token comment">// all checks and throwing code go here</span>

  <span class="token comment">// ** no throwing code below this line **</span>

  <span class="token comment">// all event emissions &amp; storage writes go here</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Do not use runtime storage to store intermediate or transient data within the context of an operation that is logically atomic or data that will not be needed if the operation is to fail. This does not mean that runtime storage should not be used to track the state of ongoing actions that require multiple atomic operations, as in the case of <a href="https://substrate.dev/rustdocs/v2.0.0/pallet_utility/enum.Call.html#variant.as_multi">the multi-signature capabilities from the Utility pallet</a>. In this case, runtime storage is used to track the signatories on a dispatchable call even though a given call may never receive enough signatures to actually be invoked. In this case, each signature is considered an atomic event in the ongoing multi-signature operation; the data needed to record a single signature is not stored until after all the preconditions associated with that signature have been met.</p>
<h3><a class="anchor" aria-hidden="true" id="create-bounds"></a><a href="#create-bounds" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create Bounds</h3>
<p>Creating bounds on the size of storage items is an extremely effective way to control the use of runtime storage and one that is used repeatedly throughout the Substrate codebase. In general, any storage item whose size is determined by user action should have a bound on it. <a href="https://substrate.dev/rustdocs/v2.0.0/pallet_utility/trait.Trait.html#associatedtype.MaxSignatories">The multi-signature capabilities from the Utility pallet</a> that were described above are one such example. In this case, the list of signatories associated with a multi-signature operation is provided by the multi-signature participants. Because this signatory list is <a href="#what-to-store">necessary to come to consensus</a> on the state of the multi-signature operation, it must be stored in the runtime. However, in order to give runtime developers control over how much space in storage these lists may occupy, the Utility pallet requires users to configure a bound on this number that will be included as a <a href="#verify-first-write-last">precondition</a> before anything is written to storage.</p>
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<h3><a class="anchor" aria-hidden="true" id="进一步学习"></a><a href="#进一步学习" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进一步学习</h3>
<p>Read <a href="../advanced/storage">the advanced storage documentation</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="例子"></a><a href="#例子" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>例子</h3>
<p>Check out the Substrate Recipes covering various topics on storage:</p>
<ul>
<li><a href="https://substrate.dev/recipes/storage-maps.html">Storage Maps</a>.</li>
<li><a href="https://substrate.dev/recipes/cache.html">Caching Storage Calls</a>.</li>
<li><a href="https://substrate.dev/recipes/vec-set.html">Using Vectors</a>.</li>
<li><a href="https://substrate.dev/recipes/map-set.html">Using Maps</a>.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="参考文档"></a><a href="#参考文档" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考文档</h3>
<ul>
<li>Visit the reference docs for the <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/macro.decl_storage.html"><code>decl_storage!</code> macro</a> for more details about the available storage declarations.</li>
<li>Visit the reference docs for <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageValue.html">StorageValue</a>, <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageMap.html">StorageMap</a> and <a href="https://substrate.dev/rustdocs/v2.0.0/frame_support/storage/trait.StorageDoubleMap.html">StorageDoubleMap</a> to learn more about their APIs.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/knowledgebase/runtime/metadata"><span class="arrow-prev">← </span><span>Runtime 元数据</span></a><a class="docs-next button" href="/docs/zh-CN/knowledgebase/runtime/origin"><span>Runtime 来源</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#存储项">存储项</a><ul class="toc-headings"><li><a href="#storage-value">Storage Value</a></li><li><a href="#storage-maps">Storage Maps</a></li></ul></li><li><a href="#声明存储项">声明存储项</a><ul class="toc-headings"><li><a href="#可见性">可见性</a></li><li><a href="#getter方法">Getter方法</a></li><li><a href="#缺省值">缺省值</a></li><li><a href="#创世配置">创世配置</a></li></ul></li><li><a href="#访问存储项">访问存储项</a></li><li><a href="#最佳实践">最佳实践</a><ul class="toc-headings"><li><a href="#存储什么">存储什么</a></li><li><a href="#verify-first-write-last">Verify First, Write Last</a></li><li><a href="#create-bounds">Create Bounds</a></li></ul></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#进一步学习">进一步学习</a></li><li><a href="#例子">例子</a></li><li><a href="#参考文档">参考文档</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Developer Hub</h5><a href="/zh-CN/tutorials">Tutorials</a><a href="/docs/zh-CN/">Knowledge Base</a><a href="https://substrate.dev/recipes/">Recipes</a><a href="https://substrate.dev/rustdocs">API Reference</a></div><div><h5>Community</h5><a href="/zh-CN/community">Community Home</a><a href="/zh-CN/newsletter">Newsletter</a><a href="https://app.element.io/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Substrate Technical Chat</a><a href="/zh-CN/seminar">Substrate Seminar</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders Program</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="/terms">Terms of Use</a><a href="#" id="cookie-settings">Cookie Settings<script>
                var cookieSettings = document.getElementById('cookie-settings');
                cookieSettings.onclick = function() {
                  return klaro.show();
                };
              </script></a></div></section><section class="copyright">Copyright © 2020 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>