<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>交易费用 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="When a block author constructs a block, it must limit the block&#x27;s execution time. A block body consists of a series of [extrinsics](../learn-substrate/extrinsics). Since the resources needed to execute an extrinsic can vary, Substrate provides a flexible mechanism called &quot;weights&quot; to characterize the _time_ it takes to execute an extrinsic. To be economically sustainable and to limit spam, some transactions --- primarily those dispatched by users --- require a fee prior to transaction execution."/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="交易费用 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="When a block author constructs a block, it must limit the block&#x27;s execution time. A block body consists of a series of [extrinsics](../learn-substrate/extrinsics). Since the resources needed to execute an extrinsic can vary, Substrate provides a flexible mechanism called &quot;weights&quot; to characterize the _time_ it takes to execute an extrinsic. To be economically sustainable and to limit spam, some transactions --- primarily those dispatched by users --- require a fee prior to transaction execution."/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/ui.js" defer=""></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-CN/" target="_self">文档</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">Recipes</a></li><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/zh-CN/community" target="_self">社区</a></li><li class=""><a href="https://github.com/paritytech/substrate" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/knowledgebase/runtime/fees">English</a></li><li><a href="/docs/ru/knowledgebase/runtime/fees">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Runtime</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">开始<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/windows-users">Getting Started on Windows</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/glossary">词汇表</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Learn Substrate<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/tx-pool">Transaction Pool</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/account-abstractions">Account Abstractions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/session-keys">会话密钥</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/weight">交易权重</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/off-chain-workers">链外计算</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Runtime<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/primitives">运行时原语</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/frame">FRAME</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/pallets">Pallets</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/macros">运行时宏</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/metadata">Runtime Metadata</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/storage">Runtime Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/origin">Runtime Origin</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/execution">运行时执行</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/events">运行时事件</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/fees">交易费用</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/off-chain-workers">链外计算</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/tests">运行时测试</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">智能合约<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/">ink! Smart Contracts</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/overview">概览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/ink-fundamentals">ink! Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/env-types">智能合约运行时环境类型</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/ink-development">ink! Development</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/evm-pallet">EVM Pallet</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/faq">ink! F.A.Q.</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Integrate<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/polkadot-js">Polkadot-JS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/libraries">Client Libraries</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/chain-spec">链描述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/subkey">The subkey Tool</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Advanced<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/codec">SCALE 编解码器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/consensus">Consensus</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/block-import">The Block Import Pipeline</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/executor">Executor</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/cryptography">密码学</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/storage">Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/ss58-address-format">SS58 地址格式</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">贡献<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/contribute/help-translate">参与翻译</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">交易费用</h1></header><article><div><span><p>When a block author constructs a block, it must limit the block's execution time. A block body consists of a series of <a href="../learn-substrate/extrinsics">extrinsics</a>. Since the resources needed to execute an extrinsic can vary, Substrate provides a flexible mechanism called &quot;weights&quot; to characterize the <em>time</em> it takes to execute an extrinsic. To be economically sustainable and to limit spam, some transactions --- primarily those dispatched by users --- require a fee prior to transaction execution.</p>
<p>Although an extrinsic's weight is only one component of the fee charged to its sender, it is recommended to understand the <a href="../learn-substrate/weight">weight system</a> before reading this document.</p>
<h2><a class="anchor" aria-hidden="true" id="费用计算"></a><a href="#费用计算" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>费用计算</h2>
<p>The final fee of a dispatch is calculated using the weight of the dispatchable function and a number of configurable parameters.</p>
<h3><a class="anchor" aria-hidden="true" id="打包费用"></a><a href="#打包费用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包费用</h3>
<p>A transaction fee consists of two parts:</p>
<ul>
<li><code>length_fee</code>: A per-byte fee that is multiplied by the length, in bytes, of the encoded extrinsic. See <a href="https://crates.parity.io/pallet_transaction_payment/trait.Trait.html#associatedtype.TransactionByteFee"><code>TransactionByteFee</code></a>.</li>
<li><code>weight_fee</code>: A fee based on the weight of the extrinsic, which is a function of two parameters. One, an <code>ExtrinsicBaseWeight</code> that is declared in the runtime and applies to all extrinsics. The base weight covers inclusion overhead like signature verification. Two, a flexible <code>#[weight]</code> annotation that accounts for an extrinsic's complexity. In order to convert the weight to <code>Currency</code>, the runtime must define a <a href="https://crates.parity.io/pallet_transaction_payment/trait.Trait.html#associatedtype.WeightToFee"><code>WeightToFee</code></a> struct that implements a conversion function, <a href="https://crates.parity.io/sp_runtime/traits/trait.Convert.html"><code>Convert&lt;Weight,Balance&gt;</code></a>.</li>
</ul>
<p>基于上述情况，一个可调度交易的最终费用为：</p>
<pre><code class="hljs">fee <span class="token operator">=</span>
  <span class="token function">len</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token operator">*</span> length_fee <span class="token operator">+</span>
  <span class="token function">WeightToFee</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span>
</code></pre>
<p>This <code>fee</code> is known as the &quot;inclusion fee&quot;. Note that the extrinsic sender is charged the inclusion fee <em>prior</em> to the actual invocation of the extrinsic, so its cost will still be incurred if execution fails. In the event that an account does not have a sufficient balance to pay the fee and remain alive (i.e. existential deposit plus inclusion fee), no fee will be deducted and the transaction will not begin execution. This latter case should be rare as the transaction queue and block construction logic perform checks prior to adding an extrinsic to a block.</p>
<h3><a class="anchor" aria-hidden="true" id="费用乘数因子"></a><a href="#费用乘数因子" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>费用乘数因子</h3>
<p>上述公式给出的费用对于相同的输入始终是相同的。 However, weight can be dynamic and, based on how <a href="https://crates.parity.io/pallet_transaction_payment/trait.Trait.html#associatedtype.WeightToFee"><code>WeightToFee</code></a> is defined, the final fee can include some degree of variability. To fulfill this requirement, Substrate provides:</p>
<ul>
<li><a href="https://crates.parity.io/pallet_transaction_payment/struct.Module.html#method.next_fee_multiplier"><code>NextFeeMultiplier</code></a>: A configurable multiplier stored in the Transaction Payment module.</li>
<li><a href="https://crates.parity.io/pallet_transaction_payment/trait.Trait.html#associatedtype.FeeMultiplierUpdate"><code>FeeMultiplierUpdate</code></a>: A configurable parameter for a runtime to describe how this multiplier can change.</li>
</ul>
<p><code>NextFeeMultiplier</code> 的类型为 <code>Fixed64</code>，它可以表示一个固定的浮点数。 因此上面的打包费用公式，最终版本将为：</p>
<pre><code class="hljs">fee <span class="token operator">=</span>
  <span class="token function">len</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token operator">*</span> length_fee <span class="token operator">+</span>
  <span class="token function">WeightToFee</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span>

final_fee <span class="token operator">=</span> fee <span class="token operator">*</span> NextFeeMultiplier
</code></pre>
<p>更新 <code>NextFeeMultiplier</code> 与更新 <code>WeightToFee</code> 具有类似的效果。 交易支付模块中的 <code>FeeMultiplierUplierUpdate</code> 关联类型定义为 <code>Convert&lt;Fixed64, Fixed64&gt;</code>，应为：</p>
<blockquote>
<p>“它接收前一个乘数并返回下一个乘数”。</p>
</blockquote>
<p>默认更新函数受Polkadot网络的启发，并实现了目标调整，其中定义了区块权重的目标饱和度。 如果前一个区块更加饱和，则费用会略有增加。 同样，如果前一个区块的交易量少于目标交易量，则费用将会减少一小部分。 More information about this can be found in the <a href="https://research.web3.foundation/en/latest/polkadot/Token%20Economics.html#relay-chain-transaction-fees-and-per-block-transaction-limits">Web3 research page</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="附加费用："></a><a href="#附加费用：" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>附加费用：</h2>
<p>Inclusion fees must be computable prior to execution, and therefore can only represent fixed logic. Some transactions warrant limiting resources with other strategies. For example:</p>
<ul>
<li>Bonds: A bond is a type of fee that will either be returned or slashed after some on-chain event. For example, runtime developers may want to implement a bond in order to participate in a vote; in this example the bond could be returned at the end of the referendum or slashed if the voter tried anything malicious.</li>
<li>Deposits: Deposits are fees that may be returned later. For example, users may be required to pay a deposit in order to execute an operation that uses storage; if a subsequent operation frees that storage, the user's deposit could be returned.</li>
<li>Burns: A transaction may burn funds internally based on its logic. For example, a transaction may burn funds from the sender if it creates new storage entries, thus increasing the state size.</li>
<li>Limits: Runtime developers are free to enforce constant or configurable limits on certain operations. For example, the default Staking pallet only allows nominators to nominate 16 validators in order to limit the complexity of the validator election process.</li>
</ul>
<p>重要的是要注意，如果在链中查询交易费用，则只会返回打包费用。</p>
<h2><a class="anchor" aria-hidden="true" id="default-weight-annotations"></a><a href="#default-weight-annotations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Default Weight Annotations</h2>
<p>All dispatchable functions in Substrate must specify a weight. The way of doing that is using the annotation-based system that lets you combine fixed values for database read/write weight and/or fixed values based on benchmarks. The most basic example would look like this:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[weight = 100_000]</span>
<span class="token keyword">fn</span> <span class="token function">my_dispatchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Please note that the <code>ExtrinsicBaseWeight</code> is automatically added to the declared weight in order to account for the costs of simply including an empty extrinsic into a block.</p>
<h3><a class="anchor" aria-hidden="true" id="parameterizing-over-database-accesses"></a><a href="#parameterizing-over-database-accesses" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parameterizing over Database Accesses</h3>
<p>In order to make weight annotations independent of the deployed database backend, they are defined as a constant and then used in the annotations when expressing database accesses performed by the dispatchable:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[weight = T::DbWeight::get().reads_writes(1, 2) + 20_000]</span>
<span class="token keyword">fn</span> <span class="token function">my_dispatchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This dispatchable does one database read and two database writes in addition to other things that add the additional 20,000. A database access is generally every time a value that is declared inside the <code>decl_storage!</code> block is accessed. However, only unique accesses are counted because once a value is accessed it is cached and accessing it again does not result in a database operation. That is:</p>
<ul>
<li>Multiple reads of the same value count as one read.</li>
<li>Multiple writes of the same value count as one write.</li>
<li>Multiple reads of the same value, followed by a write to that value, count as one read and one write.</li>
<li>A write followed by a read only counts as one write.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="dispatch-classes"></a><a href="#dispatch-classes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dispatch Classes</h3>
<p>Dispatches are broken into three classes: <code>Normal</code>, <code>Operational</code>, and <code>Mandatory</code>. When not defined otherwise in the weight annotation, a dispatch is <code>Normal</code>. The developer can specify that the dispatchable uses another class like this:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[weight = (100_000, DispatchClass::Operational)]</span>
<span class="token keyword">fn</span> <span class="token function">my_dispatchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This tuple notation also allows specifying a final argument that determines whether or not the user is charged based on the annotated weight. When not defined otherwise, <code>Pays::Yes</code> is assumed:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[weight = (100_000, DispatchClass::Normal, Pays::No)]</span>
<span class="token keyword">fn</span> <span class="token function">my_dispatchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="normal-dispatches"></a><a href="#normal-dispatches" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Normal Dispatches</h4>
<p>Dispatches in this class represent normal user-triggered transactions. These types of dispatches may only consume a portion of a block's total weight limit; this portion can be found by examining the <a href="https://crates.parity.io/frame_system/trait.Trait.html#associatedtype.AvailableBlockRatio"><code>AvailableBlockRatio</code></a>. Normal dispatches are sent to the <a href="../learn-substrate/tx-pool">transaction pool</a>.</p>
<h4><a class="anchor" aria-hidden="true" id="operational-dispatches"></a><a href="#operational-dispatches" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Operational Dispatches</h4>
<p>As opposed to normal dispatches, which represent <em>usage</em> of network capabilities, operational dispatches are those that <em>provide</em> network capabilities. These types of dispatches may consume the entire weight limit of a block, which is to say that they are not bound by the <a href="https://crates.parity.io/frame_system/trait.Trait.html#associatedtype.AvailableBlockRatio"><code>AvailableBlockRatio</code></a>. Dispatches in this class are given maximum priority and are exempt from paying the <code>length_fee</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="mandatory-dispatches"></a><a href="#mandatory-dispatches" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mandatory Dispatches</h4>
<p>Mandatory dispatches will be included in a block even if they cause the block to surpass its weight limit. This dispatch class may only be applied to <a href="../learn-substrate/extrinsics#Inherents">inherents</a> and is intended to represent functions that are part of the block validation process. Since these kinds of dispatches are always included in a block regardless of the function weight, it is critical that the function's validation process prevents malicious validators from abusing the function in order to craft blocks that are valid but impossibly heavy. This can typically be accomplished by ensuring that the operation is always very light and can only be included in a block once. In order to make it more difficult for malicious validators to abuse these types of dispatches, they may not be included in blocks that return errors. This dispatch class exists to serve the assumption that it is better to allow an overweight block to be created than to not allow any block to be created at all.</p>
<h3><a class="anchor" aria-hidden="true" id="dynamic-weights"></a><a href="#dynamic-weights" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dynamic Weights</h3>
<p>In addition to purely fixed weights and constants, the weight calculation can consider the input arguments of a dispatchable. The weight should be trivially computable from the input arguments with some basic arithmetic:</p>
<pre><code class="hljs css language-rust">#<span class="token punctuation">[</span>weight <span class="token operator">=</span> <span class="token function">FunctionOf</span><span class="token punctuation">(</span>
  <span class="token operator">|</span>args<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>Vec<span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">|</span> args<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saturating_mul</span><span class="token punctuation">(</span><span class="token number">10_000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  DispatchClass<span class="token punctuation">::</span>Normal<span class="token punctuation">,</span>
  Pays<span class="token punctuation">::</span>Yes<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">fn</span> <span class="token function">handle_users</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> calls<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something per user</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="post-dispatch-weight-correction"></a><a href="#post-dispatch-weight-correction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Post Dispatch Weight Correction</h2>
<p>Depending on the execution logic, a dispatchable may consume less weight than was prescribed pre-dispatch. Why this is useful is explained in the <a href="../learn-substrate/weight#post-dispatch-weight-correction">weights article</a>. In order to correct weight, the dispatchable declares a different return type and then returns its actual weight:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[weight = 10_000 + 500_000_000]</span>
<span class="token keyword">fn</span> <span class="token function">expensive_or_cheap</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> u64<span class="token punctuation">)</span> <span class="token punctuation">-></span> DispatchResultWithPostInfo <span class="token punctuation">{</span>
    <span class="token keyword">let</span> was_heavy <span class="token operator">=</span> <span class="token function">do_calculation</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>was_heavy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// None means "no correction" from the weight annotation.</span>
        <span class="token function">Ok</span><span class="token punctuation">(</span>None<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Return the actual weight consumed.</span>
        <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">10_000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="自定义费用"></a><a href="#自定义费用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义费用</h2>
<p>还可以通过自定义权重函数或打包费用函数定义自定义费用系统。</p>
<h3><a class="anchor" aria-hidden="true" id="自定义权重"></a><a href="#自定义权重" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义权重</h3>
<p>Instead of using the default weight annotations described above, one can create a custom weight calculation type. This type must implement the follow traits:</p>
<ul>
<li>[<code>WeighData&lt;T&gt;</code>]: To determine the weight of the dispatch.</li>
<li></li>
<li>[<code>PaysFee&lt;T&gt;</code>]: To determine whether the dispatchable's sender pays fees.</li>
</ul>
<p>然后 Substrate 将两个特征的输出信息绑定到[<code>DispatchInfo</code>] 结构中，并通过为所有<code>Call</code> 变体和不透明的外部交易类型实现 <code>GetDispatchInfo</code> 来提供它。 这被 System 和 Executive 模块内部使用；您可能不会使用它。</p>
<p><code>ClassifyDispatch</code>, <code>WeighData</code>, and <code>PaysFee</code> are generic over <code>T</code>, which gets resolved into the tuple of all dispatch arguments except for the origin. To demonstrate, we will craft a struct that calculates the weight as <code>m * len(args)</code> where <code>m</code> is a given multiplier and <code>args</code> is the concatenated tuple of all dispatch arguments. Further, the dispatch class is <code>Operational</code> if the transaction has more than 100 bytes of length in arguments and will pay fees if the encoded length is greater than 10 bytes.</p>
<pre><code class="hljs css language-rust"><span class="token keyword">use</span> coded<span class="token punctuation">::</span>Encode<span class="token punctuation">;</span>
<span class="token keyword">use</span> sr_primitives<span class="token punctuation">::</span>weights<span class="token punctuation">::</span><span class="token punctuation">{</span>DispatchClass<span class="token punctuation">,</span> ClassifyDispatch<span class="token punctuation">,</span> WeightData<span class="token punctuation">}</span>

<span class="token comment">// self.0 is the multiplier, `m`</span>
<span class="token keyword">struct</span> <span class="token function">LenWeight</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// We don't quite know what T is. After all, different dispatches have different arguments, hence</span>
<span class="token comment">// `T` will be different. All that we care about is that `T` is encodable. That is always true by</span>
<span class="token comment">// definition. All dispatch arguments are encodable.</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Encode<span class="token operator">></span> WeighData<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">for</span> LenWeight <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">weigh_data</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Weight <span class="token punctuation">{</span>
        <span class="token keyword">let</span> multiplier <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> encoded_len <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> u32<span class="token punctuation">;</span>
        multiplier <span class="token operator">*</span> encoded_len
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Encode<span class="token operator">></span> ClassifyDispatch<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">for</span> LenWeight <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">classify_dispatch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> DispatchClass <span class="token punctuation">{</span>
        <span class="token keyword">let</span> encoded_len <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> u32<span class="token punctuation">;</span>
        <span class="token keyword">if</span> encoded_len <span class="token operator">></span> <span class="token number">100</span> <span class="token punctuation">{</span>
            DispatchClass<span class="token punctuation">::</span>Operational
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            DispatchClass<span class="token punctuation">::</span>Normal
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Encode<span class="token operator">></span> PaysFee<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">pays_fee</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Pays <span class="token punctuation">{</span>
        <span class="token keyword">let</span> encoded_len <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> u32<span class="token punctuation">;</span>
        <span class="token keyword">if</span> encoded_len <span class="token operator">></span> <span class="token number">10</span> <span class="token punctuation">{</span>
            Pays<span class="token punctuation">::</span>Yes
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            Pays<span class="token punctuation">::</span>No
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>权重计算器函数也可以强制参数的最终类型，而不是将其定义为可编码的模糊类型。 <code>pallet-example</code> contains an example of how to do this. 请注意，在这种情况下，代码大致如下所示：</p>
<pre><code class="hljs css language-rust"><span class="token keyword">struct</span> CustomWeight<span class="token punctuation">;</span>
<span class="token keyword">impl</span> WeighData<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u32<span class="token punctuation">,</span> <span class="token operator">&amp;</span>u64<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">for</span> CustomWeight <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">weigh_data</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>u32<span class="token punctuation">,</span> <span class="token operator">&amp;</span>u64<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Weight <span class="token punctuation">{</span>
        <span class="token punctuation">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// given dispatch:</span>
<span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[weight = CustomWeight]</span>
    <span class="token keyword">fn</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> b<span class="token punctuation">:</span> u64<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这意味着自定义权重 <code>CustomWeight</code> 只能与带有特定签名 <code>(u32, u64)</code> 的调度一起使用，而 <code>Lenweight</code> 则可以随意使用，因为它没有对 <code>&lt;T&gt;</code> 作任何严格的假设。</p>
<h3><a class="anchor" aria-hidden="true" id="自定义打包费用"></a><a href="#自定义打包费用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义打包费用</h3>
<p>这是如何自定义打包费用的示例。 必须在相应的模块中配置适当的关联类型。</p>
<pre><code class="hljs css language-rust"><span class="token keyword">use</span> sr_primitives<span class="token punctuation">::</span><span class="token punctuation">{</span>traits<span class="token punctuation">::</span>Convert<span class="token punctuation">,</span> weights<span class="token punctuation">::</span>Weight<span class="token punctuation">}</span>
<span class="token comment">// Assume this is the balance type</span>
<span class="token keyword">type</span> Balance <span class="token operator">=</span> u64<span class="token punctuation">;</span>

<span class="token comment">// Assume we want all the weights to have a `100 + 2 * w` conversion to fees</span>
<span class="token keyword">struct</span> CustomWeightToFee<span class="token punctuation">;</span>
<span class="token keyword">impl</span> Convert<span class="token operator">&lt;</span>Weight<span class="token punctuation">,</span> Balance<span class="token operator">></span> <span class="token keyword">for</span> CustomWeightToFee <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">convert</span><span class="token punctuation">(</span>w<span class="token punctuation">:</span> Weight<span class="token punctuation">)</span> <span class="token punctuation">-></span> Balance <span class="token punctuation">{</span>
        <span class="token keyword">let</span> a <span class="token operator">=</span> Balance<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> b <span class="token operator">=</span> Balance<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> w <span class="token operator">=</span> Balance<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
        a <span class="token operator">+</span> b <span class="token operator">*</span> w
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro-rules function">parameter_types!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">const</span> ExtrinsicBaseWeight<span class="token punctuation">:</span> Weight <span class="token operator">=</span> <span class="token number">10_000_000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> frame_system<span class="token punctuation">::</span>Trait <span class="token keyword">for</span> Runtime <span class="token punctuation">{</span>
    <span class="token keyword">type</span> ExtrinsicBaseWeight <span class="token operator">=</span> ExtrinsicBaseWeight<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro-rules function">parameter_types!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">const</span> TransactionByteFee<span class="token punctuation">:</span> Balance <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> transaction_payment<span class="token punctuation">::</span>Trait <span class="token punctuation">{</span>
    <span class="token keyword">type</span> TransactionByteFee <span class="token operator">=</span> TransactionByteFee<span class="token punctuation">;</span>
    <span class="token keyword">type</span> WeightToFee <span class="token operator">=</span> CustomWeightToFee<span class="token punctuation">;</span>
    <span class="token keyword">type</span> FeeMultiplierUpdate <span class="token operator">=</span> TargetedFeeAdjustment<span class="token operator">&lt;</span>TargetBlockFullness<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> TargetedFeeAdjustment<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>sp_std<span class="token punctuation">::</span>marker<span class="token punctuation">::</span>PhantomData<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Get<span class="token operator">&lt;</span>Perquintill<span class="token operator">>></span> Convert<span class="token operator">&lt;</span>Fixed128<span class="token punctuation">,</span> Fixed128<span class="token operator">></span> <span class="token keyword">for</span> TargetedFeeAdjustment<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">convert</span><span class="token punctuation">(</span>multiplier<span class="token punctuation">:</span> Fixed128<span class="token punctuation">)</span> <span class="token punctuation">-></span> Fixed128 <span class="token punctuation">{</span>
        <span class="token comment">// Don't change anything. Put any fee update info here.</span>
        multiplier
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<p>The entire logic of fees is encapsulated in <code>pallet-transaction-payment</code> via a <code>SignedExtension</code>. 虽然此模块提供了高度的灵活性，但用户可以选择从交易支付中汲取灵感来构建自己的自定义支付模块。</p>
<h3><a class="anchor" aria-hidden="true" id="learn-more"></a><a href="#learn-more" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Learn More</h3>
<ul>
<li>Dedicated <a href="../learn-substrate/weight">weight documentation</a></li>
<li><a href="https://github.com/paritytech/substrate/blob/master/frame/example/src/lib.rs">示例模块</a></li>
<li><a href="https://crates.parity.io/sp_runtime/traits/trait.SignedExtension.html">SignedExtension</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h3>
<p>Substrate Recipes contains examples of both <a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/weights">custom weights</a> and custom <a href="https://github.com/substrate-developer-hub/recipes/tree/master/runtimes/weight-fee-runtime">WeightToFee</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="references"></a><a href="#references" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h3>
<ul>
<li><a href="https://research.web3.foundation/en/latest/polkadot/Token%20Economics.html#relay-chain-transaction-fees-and-per-block-transaction-limits">Web3 Foundation Research</a></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/knowledgebase/runtime/events"><span class="arrow-prev">← </span><span>运行时事件</span></a><a class="docs-next button" href="/docs/zh-CN/knowledgebase/runtime/off-chain-workers"><span>链外计算</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#费用计算">费用计算</a><ul class="toc-headings"><li><a href="#打包费用">打包费用</a></li><li><a href="#费用乘数因子">费用乘数因子</a></li></ul></li><li><a href="#附加费用：">附加费用：</a></li><li><a href="#default-weight-annotations">Default Weight Annotations</a><ul class="toc-headings"><li><a href="#parameterizing-over-database-accesses">Parameterizing over Database Accesses</a></li><li><a href="#dispatch-classes">Dispatch Classes</a></li><li><a href="#dynamic-weights">Dynamic Weights</a></li></ul></li><li><a href="#post-dispatch-weight-correction">Post Dispatch Weight Correction</a></li><li><a href="#自定义费用">自定义费用</a><ul class="toc-headings"><li><a href="#自定义权重">自定义权重</a></li><li><a href="#自定义打包费用">自定义打包费用</a></li></ul></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#learn-more">Learn More</a></li><li><a href="#examples">Examples</a></li><li><a href="#references">References</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/zh-CN/">Getting Started</a><a href="/zh-CN/tutorials">Tutorials</a><a href="https://crates.parity.io/">Reference Docs</a><a href="https://substrate.dev/recipes/">Recipes</a></div><div><h5>Community</h5><a href="/zh-CN/videos">Videos</a><a href="/zh-CN/seminar">Substrate Seminar</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders Program</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="#" id="cookie-settings">Cookie Settings<script>
              var cookieSettings = document.getElementById('cookie-settings');
              cookieSettings.onclick = function() {
                return klaro.show();
              };
              </script></a></div></section><section class="copyright">Copyright © 2020 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>