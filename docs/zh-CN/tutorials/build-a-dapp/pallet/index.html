<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>构建一个自定义Pallet · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Substrate 运行时由FRAME 托盘组成。 You can think of these pallets as individual pieces of logic that define what your blockchain can do! Substrate provides you with a number of pre-built pallets for use in FRAME-based runtimes."/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="构建一个自定义Pallet · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="Substrate 运行时由FRAME 托盘组成。 You can think of these pallets as individual pieces of logic that define what your blockchain can do! Substrate provides you with a number of pre-built pallets for use in FRAME-based runtimes."/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/ui.js" defer=""></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/zh-CN/" target="_self">文档</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">Recipes</a></li><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/zh-CN/community" target="_self">社区</a></li><li class=""><a href="https://github.com/paritytech/substrate" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/tutorials/build-a-dapp/pallet">English</a></li><li><a href="/docs/ru/tutorials/build-a-dapp/pallet">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Build a PoE Decentralized Application</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Build a PoE Decentralized Application<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/">介绍</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/prepare">Prepare to build a dApp</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/pallet">构建一个自定义Pallet</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/front-end">Building a Custom Front End</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">构建一个自定义Pallet</h1></header><article><div><span><p>Substrate 运行时由FRAME 托盘组成。 You can think of these pallets as individual pieces of logic that define what your blockchain can do! Substrate provides you with a number of pre-built pallets for use in FRAME-based runtimes.</p>
<p><img src="/docs/assets/tutorials/build-a-dapp/runtime.png" alt="Runtime Composition"></p>
<p>For example, FRAME includes a <a href="https://substrate.dev/rustdocs/v2.0.0-rc2/pallet_balances/">Balances</a> pallet that controls the underlying currency of your blockchain by managing the <em>balance</em> of all the accounts in your system.</p>
<p>If you want to add smart contract functionality to your blockchain, you simply need to include the <a href="https://substrate.dev/rustdocs/v2.0.0-rc2/pallet_contracts/">Contracts</a> pallet.</p>
<p>Even things like on-chain governance can be added to your blockchain by including pallets like <a href="https://substrate.dev/rustdocs/v2.0.0-rc2/pallet_democracy/">Democracy</a>, <a href="https://substrate.dev/rustdocs/v2.0.0-rc2/pallet_elections/">Elections</a>, and <a href="https://substrate.dev/rustdocs/v2.0.0-rc2/pallet_collective/">Collective</a>.</p>
<p>The goal of this tutorial is to teach you how to create your own Substrate pallet to include in your custom blockchain! The <code>substrate-node-template</code> comes with a template pallet that we will build your custom logic on top of.</p>
<h2><a class="anchor" aria-hidden="true" id="file-structure"></a><a href="#file-structure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>File Structure</h2>
<p>我们现在将修改 <code>substrate-node-template</code> 来介绍一个 存在性证明Pallet的基本功能。</p>
<p>在您最喜欢的代码编辑器中打开 <code>substrate-node-template</code>。 Then open the file <code>pallets/template/src/lib.rs</code></p>
<pre><code class="hljs">substrate<span class="token operator">-</span>node<span class="token operator">-</span>template
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> runtime
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> pallets
<span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> template
<span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> Cargo<span class="token punctuation">.</span>toml    <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> One change <span class="token keyword">in</span> this file
<span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> src
<span class="token operator">|</span>           <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> lib<span class="token punctuation">.</span>rs     <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> Most changes <span class="token keyword">in</span> this file
<span class="token operator">|</span>           <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> mock<span class="token punctuation">.</span>rs
<span class="token operator">|</span>           <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> tests<span class="token punctuation">.</span>rs
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> scripts
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> node
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">...</span>
</code></pre>
<p>您将看到一些预写的代码作为新Pallet的模板。 You can read over this file if you like, and then delete the contents since we will start from scratch for full transparency. When writing your own pallets in the future, you will likely find the scaffolding in this template pallet useful.</p>
<h2><a class="anchor" aria-hidden="true" id="构建您的新pallet"></a><a href="#构建您的新pallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建您的新Pallet</h2>
<p>At a high level, a Substrate pallet can be broken down into six sections:</p>
<pre><code class="hljs css language-rust"><span class="token comment">// 1. Imports</span>
<span class="token keyword">use</span> frame_support<span class="token punctuation">::</span><span class="token punctuation">{</span>decl_module<span class="token punctuation">,</span> decl_storage<span class="token punctuation">,</span> decl_event<span class="token punctuation">,</span> decl_error<span class="token punctuation">,</span> dispatch<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> frame_system<span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token keyword">self</span> <span class="token keyword">as</span> system<span class="token punctuation">,</span> ensure_signed<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2. Pallet 配置</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> Trait<span class="token punctuation">:</span> system<span class="token punctuation">::</span>Trait <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 3. Pallet 存储项</span>
<span class="token macro-rules function">decl_storage!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 4. Pallet 事件</span>
<span class="token macro-rules function">decl_event!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 5. Pallet Errors</span>
<span class="token macro-rules function">decl_error!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 6. Callable Pallet 函数</span>
decl_module！ <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>
</code></pre>
<p>Things like events, storage, and callable functions may look familiar to you if you have done other blockchain development. We will show you what each of these components look like for a basic Proof Of Existence pallet.</p>
<h3><a class="anchor" aria-hidden="true" id="imports-and-dependencies"></a><a href="#imports-and-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Imports and Dependencies</h3>
<p>Since imports are pretty boring, you can start by copying this at the top of your empty <code>lib.rs</code> file:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#![cfg_attr(not(feature = "std"), no_std)]</span>

<span class="token keyword">use</span> frame_support<span class="token punctuation">::</span><span class="token punctuation">{</span>
    decl_module<span class="token punctuation">,</span> decl_storage<span class="token punctuation">,</span> decl_event<span class="token punctuation">,</span> decl_error<span class="token punctuation">,</span> ensure<span class="token punctuation">,</span> StorageMap
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> frame_system<span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token keyword">self</span> <span class="token keyword">as</span> system<span class="token punctuation">,</span> ensure_signed<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> sp_std<span class="token punctuation">::</span>vec<span class="token punctuation">::</span>Vec<span class="token punctuation">;</span>
</code></pre>
<p>Most of these imports are already available because they were used in the template pallet whose code we just deleted. However, <code>sp_std</code> is not available and we need to list it as a dependency.</p>
<p><strong>Add</strong> this block to your <code>pallets/template/Cargo.toml</code> file.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies.sp-std</span><span class="token punctuation">]</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'v2.0.0-rc2'</span>
</code></pre>
<p>Then, <strong>Update</strong> the existing <code>[features]</code> block to look like this. The last line is new.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">features</span><span class="token punctuation">]</span>
<span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">'std'</span><span class="token punctuation">]</span>
<span class="token key property">std</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
    <span class="token string">'codec/std'</span><span class="token punctuation">,</span>
    <span class="token string">'frame-support/std'</span><span class="token punctuation">,</span>
    <span class="token string">'frame-system/std'</span><span class="token punctuation">,</span>
    <span class="token string">'sp-std/std'</span><span class="token punctuation">,</span>          &lt;-- This line is new
<span class="token punctuation">]</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="pallet-配置"></a><a href="#pallet-配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pallet 配置</h3>
<p>Every pallet has a configuration trait. For now, the only thing we will configure about our pallet is that it will emit some Events.</p>
<pre><code class="hljs css language-rust"><span class="token comment">/// The pallet's configuration trait.</span>
<span class="token operator">&lt;</span>code<span class="token operator">></span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> Trait<span class="token punctuation">:</span> system<span class="token punctuation">::</span>Trait <span class="token punctuation">{</span>
    <span class="token comment">/// The overarching event type.</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">></span>
    <span class="token operator">&lt;</span>code<span class="token operator">></span><span class="token keyword">type</span> Event<span class="token punctuation">:</span> From<span class="token operator">&lt;</span>Event<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">>></span> <span class="token operator">+</span> Into<span class="token operator">&lt;&lt;</span><span class="token keyword">Self</span> <span class="token keyword">as</span> system<span class="token punctuation">::</span>Trait<span class="token operator">></span><span class="token punctuation">::</span>Event<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">></span>
</code></pre>
<pre><code class="hljs">type Event: From&lt;Event&lt;Self&gt;&gt; + Into&lt;&lt;Self as system::Trait&gt;::Event&gt;;
</code></pre>
<p>}
</code></p>
<h3><a class="anchor" aria-hidden="true" id="pallet-事件"></a><a href="#pallet-事件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pallet 事件</h3>
<p>在我们配置了我们Pallet触发的事件后，让我们继续定义哪些事件：</p>
<pre><code class="hljs css language-rust"><span class="token comment">// This pallet's events.</span>
<span class="token operator">&lt;</span>code<span class="token operator">></span><span class="token macro-rules function">decl_event!</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">></span> <span class="token operator">&lt;</span>code<span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> Event<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">where</span> AccountId <span class="token operator">=</span> <span class="token operator">&lt;</span>T <span class="token keyword">as</span> system<span class="token punctuation">::</span>Trait<span class="token operator">></span><span class="token punctuation">::</span>AccountId <span class="token punctuation">{</span>
        <span class="token comment">/// Event emitted when a proof has been claimed.&lt;/code></span>
        <span class="token operator">&lt;</span>code<span class="token operator">></span><span class="token function">ClaimCreated</span><span class="token punctuation">(</span>AccountId<span class="token punctuation">,</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/// Event emitted when a claim is revoked by the owner.&lt;/code></span>
        <span class="token operator">&lt;</span>code<span class="token operator">></span><span class="token function">ClaimRevoked</span><span class="token punctuation">(</span>AccountId<span class="token punctuation">,</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">></span>
</code></pre>
<p>{
pub enum Event<T> where AccountId = <T as system::Trait>::AccountId {
/// Event emitted when a proof has been claimed.
ClaimCreated(AccountId, Vec<u8>),
/// Event emitted when a claim is revoked by the owner.
ClaimRevoked(AccountId, Vec<u8>),
}
}
</code></p>
<p>我们的Pallet只会有两个事件：</p>
<ol>
<li>当一个新的证据添加到区块链中。</li>
<li>当证据被移除时。</li>
</ol>
<p>The events can contain some additional data, in this case, each event will also display who triggered the event (<code>AccountId</code>), and the proof data (as <code>Vec&lt;u8&gt;</code>) that is being stored or removed.</p>
<h2><a class="anchor" aria-hidden="true" id="pallet-errors"></a><a href="#pallet-errors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pallet Errors</h2>
<p>The events we defined previously indicate when calls to the pallet have completed successfully. Similarly, errors indicate when a call has failed, and why it has failed.</p>
<pre><code class="hljs css language-rust"><span class="token comment">// This pallet's errors.</span>
<span class="token macro-rules function">decl_error!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> Error <span class="token keyword">for</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment">/// This proof has already been claimed</span>
        ProofAlreadyClaimed<span class="token punctuation">,</span>
        <span class="token comment">/// The proof does not exist, so it cannot be revoked</span>
        NoSuchProof<span class="token punctuation">,</span>
        <span class="token comment">/// The proof is claimed by another account, so caller can't revoke it</span>
        NotProofOwner<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The first of these errors can occur when attempting to claim a new proof. Of course a user cannot claim a proof that has already been claimed. The latter two can occur when attempting to revoke a proof.</p>
<h3><a class="anchor" aria-hidden="true" id="pallet-存储项目"></a><a href="#pallet-存储项目" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pallet 存储项目</h3>
<p>为了向区块链添加新的证据，我们只需将此证据存储在我们的Pallet存储中。 要存储该值我们创建一个 <a href="https://en.wikipedia.org/wiki/Hash_table">hash map</a> 的所有者证据和证明的区块号。</p>
<pre><code class="hljs css language-rust"><span class="token comment">// This pallet's storage items.</span>
<span class="token macro-rules function">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> Store <span class="token keyword">for</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token keyword">as</span> TemplateModule <span class="token punctuation">{</span>
        <span class="token comment">/// The storage item for our proofs.</span>
        <span class="token comment">/// It maps a proof to the user who made the claim and when they made it.</span>
        Proofs<span class="token punctuation">:</span> map <span class="token function">hasher</span><span class="token punctuation">(</span>blake2_128_concat<span class="token punctuation">)</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">(</span>T<span class="token punctuation">::</span>AccountId<span class="token punctuation">,</span> T<span class="token punctuation">::</span>BlockNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>如果证明有一个所有者和一个区块号，那么我们知道它已经被确认了！ Otherwise, the proof is available to be claimed.</p>
<h3><a class="anchor" aria-hidden="true" id="callable-pallet-函数"></a><a href="#callable-pallet-函数" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Callable Pallet 函数</h3>
<p>As implied by our pallet events and errors, we will have two &quot;dispatchable functions&quot; the user can call in this Substrate pallet:</p>
<ol>
<li><code>create_claim</code> - 允许用户通过上传文件摘要来声称存在一个文件。</li>
<li><code>revoke_claim</code> - 允许当前的所有者撤销他们的所有权。</li>
</ol>
<p>Here is what the pallet declaration looks like with these these two functions:</p>
<pre><code class="hljs css language-rust"><span class="token comment">// The pallet's dispatchable functions.</span>
<span class="token macro-rules function">decl_module!</span> <span class="token punctuation">{</span>
    <span class="token comment">/// The module declaration.</span>
    <span class="token keyword">pub</span> <span class="token keyword">struct</span> Module<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Trait<span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">enum</span> Call <span class="token keyword">where</span> origin<span class="token punctuation">:</span> T<span class="token punctuation">::</span>Origin <span class="token punctuation">{</span>
        <span class="token comment">// Initializing errors</span>
        <span class="token comment">// this includes information about your errors in the node's metadata.</span>
        <span class="token comment">// it is needed only if you are using errors in your pallet</span>
        <span class="token keyword">type</span> Error <span class="token operator">=</span> Error<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">;</span>

        <span class="token comment">// A default function for depositing events</span>
        <span class="token keyword">fn</span> <span class="token function">deposit_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> default<span class="token punctuation">;</span>

        <span class="token comment">/// Allow a user to claim ownership of an unclaimed proof</span>
        <span class="token attribute attr-name">#[weight = 10_000]</span>
        <span class="token keyword">fn</span> <span class="token function">create_claim</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proof<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Verify that the incoming transaction is signed and store who the</span>
            <span class="token comment">// caller of this function is.</span>
            <span class="token keyword">let</span> sender <span class="token operator">=</span> <span class="token function">ensure_signed</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify that the specified proof has not been claimed yet or error with the message</span>
            <span class="token function">ensure!</span><span class="token punctuation">(</span><span class="token operator">!</span>Proofs<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">,</span> Error<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span>ProofAlreadyClaimed<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Call the `system` pallet to get the current block number</span>
            <span class="token keyword">let</span> current_block <span class="token operator">=</span> <span class="token operator">&lt;</span>system<span class="token punctuation">::</span>Module<span class="token operator">&lt;</span>T<span class="token operator">>></span><span class="token punctuation">::</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Store the proof with the sender and the current block number</span>
            Proofs<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>sender<span class="token punctuation">,</span> current_block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Emit an event that the claim was created</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">deposit_event</span><span class="token punctuation">(</span>RawEvent<span class="token punctuation">::</span><span class="token function">ClaimCreated</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> proof<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// Allow the owner to revoke their claim</span>
        <span class="token attribute attr-name">#[weight = 10_000]</span>
        <span class="token keyword">fn</span> <span class="token function">revoke_claim</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proof<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Determine who is calling the function</span>
            <span class="token keyword">let</span> sender <span class="token operator">=</span> <span class="token function">ensure_signed</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify that the specified proof has been claimed</span>
            <span class="token function">ensure!</span><span class="token punctuation">(</span>Proofs<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">,</span> Error<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span>NoSuchProof<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Get owner of the claim</span>
            <span class="token keyword">let</span> <span class="token punctuation">(</span>owner<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> Proofs<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify that sender of the current call is the claim owner</span>
            <span class="token function">ensure!</span><span class="token punctuation">(</span>sender <span class="token operator">==</span> owner<span class="token punctuation">,</span> Error<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span>NotProofOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Remove claim from storage</span>
            Proofs<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">::</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Emit an event that the claim was erased</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">deposit_event</span><span class="token punctuation">(</span>RawEvent<span class="token punctuation">::</span><span class="token function">ClaimRevoked</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> proof<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>The functions you see here do not have return types explicitly stated. In reality they all return <a href="https://substrate.dev/rustdocs/v2.0.0-rc2/frame_support/dispatch/type.DispatchResult.html"><code>DispatchResult</code></a>s. This return type is added on your behalf by the <code>decl_module!</code> macro.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="编译您的新pallet"></a><a href="#编译您的新pallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编译您的新Pallet</h2>
<p>After you've copied all of the parts of this pallet correctly into your <code>pallets/template/lib.rs</code> file, you should be able to recompile your node without warning or error:</p>
<pre><code class="hljs css language-bash">&lt;code&gt;cargo build --release&lt;/code&gt;
</code></pre>
<p></code></p>
<p>Now you can start your node:</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Purge chain to clean up your old chain state</span>
<span class="hljs-comment"># You will be prompted to type `y`</span>
./target/release/node-template purge-chain --dev

<span class="hljs-comment"># Re-run your node in "development" mode</span>
./target/release/node-template --dev
</code></pre>
<p>Now it is time to interact with our new Proof of Existence pallet!</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/tutorials/build-a-dapp/prepare"><span class="arrow-prev">← </span><span class="function-name-prevnext">Prepare to build a dApp</span></a><a class="docs-next button" href="/docs/zh-CN/tutorials/build-a-dapp/front-end"><span>Building a Custom Front End</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#file-structure">File Structure</a></li><li><a href="#构建您的新pallet">构建您的新Pallet</a><ul class="toc-headings"><li><a href="#imports-and-dependencies">Imports and Dependencies</a></li><li><a href="#pallet-配置">Pallet 配置</a></li><li><a href="#pallet-事件">Pallet 事件</a></li></ul></li><li><a href="#pallet-errors">Pallet Errors</a><ul class="toc-headings"><li><a href="#pallet-存储项目">Pallet 存储项目</a></li><li><a href="#callable-pallet-函数">Callable Pallet 函数</a></li></ul></li><li><a href="#编译您的新pallet">编译您的新Pallet</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/zh-CN/">Getting Started</a><a href="/zh-CN/tutorials">Tutorials</a><a href="https://crates.parity.io/">Reference Docs</a><a href="https://substrate.dev/recipes/">Recipes</a></div><div><h5>Community</h5><a href="/zh-CN/videos">Videos</a><a href="/zh-CN/seminar">Substrate Seminar</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://builders.parity.io/">Substrate Builders Program</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="#" id="cookie-settings">Cookie Settings<script>
              var cookieSettings = document.getElementById('cookie-settings');
              cookieSettings.onclick = function() {
                return klaro.show();
              };
              </script></a></div></section><section class="copyright">Copyright © 2020 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>